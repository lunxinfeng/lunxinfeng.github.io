<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="风少侠的个人博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="风少侠的个人博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="风少侠的个人博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>风少侠的个人博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">风少侠的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/View系列笔记（一）基础概念知识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风少侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风少侠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/View系列笔记（一）基础概念知识/" itemprop="url">View系列笔记（一）基础概念知识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T12:30:39+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　声明：此系列的部分内容出自《Android开发艺术探索》一书，是我当初学习时候的一些笔记和总结，在这里留个记录。<br>　　View是android中所有控件的基类。</p>
<h2 id="位置参数"><a href="#位置参数" class="headerlink" title="位置参数"></a>位置参数</h2><p>　　在Android系统中，左上角为坐标原点，x和y轴正方向分别是往右和下。View的位置由它的4个顶点来决定，即top，left，right，bottom。需要注意的是这4个点是<strong>相对坐标</strong>，相对于view的父容器来说的。获取方法：</p>
<ul>
<li>top: getTop()</li>
<li>left: getLeft()</li>
<li>right: getRight()</li>
<li>bottom: getBottom()</li>
</ul>
<p>　　从Android3.0开始，View增加了4个额外的参数：x，y，translationX，translationY。其中x和y指view左上角的坐标，translationX和translationY指view左上角相对于父容器的偏移量。这4个参数也都是<strong>相对坐标</strong>，他们之间的相互关系如下：</p>
<ul>
<li>x = left + translationX;</li>
<li>y = top + translationY;</li>
</ul>
<p>　　即：在view发生平移的过程中，left和top始终是不变的，指view原始位置的左上角坐标，发生改变的只是x，y，translationX，translationY这4个参数。</p>
<h2 id="触摸事件"><a href="#触摸事件" class="headerlink" title="触摸事件"></a>触摸事件</h2><h3 id="MotionEvent"><a href="#MotionEvent" class="headerlink" title="MotionEvent"></a>MotionEvent</h3><p>　　手指的触摸事件一般可以分为两种（姑且把单击和长按当成一种，滑动和多点触控当成一种吧，起码触发的事件是差不多的）：</p>
<ul>
<li>手指按下，不滑动，放开：DOWN—&gt;UP。</li>
<li>手指按下，滑动一段距离，再松手：DOWN—&gt;MOVE—&gt;…—&gt;MOVE—&gt;UP。</li>
</ul>
<p>　　通过MotionEvent对象我们可以得到点击位置的坐标：</p>
<ul>
<li>getX()和getY()：得到的是相对当前view左上角的坐标。</li>
<li>getRawX()和getRawY()：得到的是相对手机屏幕左上角的坐标。</li>
</ul>
<h3 id="TouchSlop"><a href="#TouchSlop" class="headerlink" title="TouchSlop"></a>TouchSlop</h3><p>　　即系统所能识别出的被认为是滑动的最小距离。常量，和硬件设备有关，可以通过ViewConfiguration.get(context).getScaledTouchSlop()得到，手指移动小于这个值得话则认为这次操作不是滑动。</p>
<h2 id="VelocityTracker"><a href="#VelocityTracker" class="headerlink" title="VelocityTracker"></a>VelocityTracker</h2><p>　　用来测量某个触摸事件的速度。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 某个触摸时间的速度测量：</span></span><br><span class="line"><span class="comment">         * 1.通过obtain()方法获得velocityTracker变量，并添加需要测量的事件</span></span><br><span class="line"><span class="comment">         * 2.通过computeCurrentVelocity计算速度（参数单位为ms），再通过getter方法获取速度值(右下滑为正数，反之为负数)</span></span><br><span class="line"><span class="comment">         * 3.释放velocityTracker对象。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        VelocityTracker velocityTracker = VelocityTracker.obtain();</span><br><span class="line">        velocityTracker.addMovement(event);</span><br><span class="line"></span><br><span class="line">        velocityTracker.computeCurrentVelocity(<span class="number">1000</span>);<span class="comment">//秒速</span></span><br><span class="line">        <span class="keyword">int</span> v_x = (<span class="keyword">int</span>) velocityTracker.getXVelocity();</span><br><span class="line">        <span class="keyword">int</span> v_y = (<span class="keyword">int</span>) velocityTracker.getYVelocity();</span><br><span class="line"></span><br><span class="line">        LogUtils.i(TAG,<span class="string">"\t\tX:"</span> + v_x + <span class="string">"\t\tY:"</span> + v_y);</span><br><span class="line"></span><br><span class="line">        velocityTracker.recycle();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="number">02</span>-<span class="number">17</span> <span class="number">11</span>:<span class="number">26</span>:<span class="number">55.483</span> <span class="number">27154</span>-<span class="number">27154</span>/lxf.androiddemos I/TestView: 		X:<span class="number">5656</span>		Y:<span class="number">1203</span></span><br><span class="line"><span class="number">02</span>-<span class="number">17</span> <span class="number">11</span>:<span class="number">26</span>:<span class="number">55.500</span> <span class="number">27154</span>-<span class="number">27154</span>/lxf.androiddemos I/TestView: 		X:<span class="number">6255</span>		Y:<span class="number">1202</span></span><br><span class="line"><span class="number">02</span>-<span class="number">17</span> <span class="number">11</span>:<span class="number">26</span>:<span class="number">55.509</span> <span class="number">27154</span>-<span class="number">27154</span>/lxf.androiddemos I/TestView: 		X:<span class="number">0</span>		Y:<span class="number">0</span></span><br><span class="line"><span class="number">02</span>-<span class="number">17</span> <span class="number">11</span>:<span class="number">26</span>:<span class="number">55.510</span> <span class="number">27154</span>-<span class="number">27154</span>/lxf.androiddemos I/TestView: 		X:<span class="number">0</span>		Y:<span class="number">0</span></span><br><span class="line"><span class="number">02</span>-<span class="number">17</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">01.207</span> <span class="number">27154</span>-<span class="number">27154</span>/lxf.androiddemos I/TestView: 		X:<span class="number">0</span>		Y:<span class="number">0</span></span><br><span class="line"><span class="number">02</span>-<span class="number">17</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">01.248</span> <span class="number">27154</span>-<span class="number">27154</span>/lxf.androiddemos I/TestView: 		X:-<span class="number">421</span>		Y:<span class="number">49</span></span><br><span class="line"><span class="number">02</span>-<span class="number">17</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">01.265</span> <span class="number">27154</span>-<span class="number">27154</span>/lxf.androiddemos I/TestView: 		X:-<span class="number">2978</span>		Y:<span class="number">372</span></span><br><span class="line"><span class="number">02</span>-<span class="number">17</span> <span class="number">11</span>:<span class="number">27</span>:<span class="number">01.282</span> <span class="number">27154</span>-<span class="number">27154</span>/lxf.androiddemos I/TestView: 		X:-<span class="number">3426</span>		Y:<span class="number">426</span></span><br></pre></td></tr></table></figure></p>
<h2 id="GestureDetector"><a href="#GestureDetector" class="headerlink" title="GestureDetector"></a>GestureDetector</h2><p>　　手势检测，用来辅助检测用户的滑动、单击、双击、长按等行为。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.实现OnGestureListener接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestView</span> <span class="keyword">extends</span> <span class="title">View</span> <span class="keyword">implements</span> <span class="title">GestureDetector</span>.<span class="title">OnGestureListener</span></span>&#123;</span><br><span class="line"><span class="comment">//2.获得GestureDetector对象,</span></span><br><span class="line">gestureDetector = <span class="keyword">new</span> GestureDetector(getContext(),<span class="keyword">this</span>);</span><br><span class="line"><span class="comment">//如果要监听双击，可以实现DoubleTapListener接口</span></span><br><span class="line">gestureDetector.setOnDoubleTapListener(mDoubleTapListener);</span><br><span class="line">...</span><br><span class="line"><span class="comment">//3.接管onTouchEvent(event)方法。</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gestureDetector.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//4.在接口的相应回调方法中实现自己的逻辑。</span></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="View的滑动"><a href="#View的滑动" class="headerlink" title="View的滑动"></a>View的滑动</h2><h3 id="scrollTo-scrollBy"><a href="#scrollTo-scrollBy" class="headerlink" title="scrollTo/scrollBy"></a>scrollTo/scrollBy</h3><p>　　scrollBy内部实际上就是调用的scrollTo方法，它实现了view基于<strong>当前位置</strong>的相对滑动，而scrollTo是相对于<strong>初始位置</strong>滚动某段距离，可以变向理解为绝对滑动。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scrollBy</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">       scrollTo(mScrollX + x, mScrollY + y);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>　　在滑动过程中，mScrollX的值总是等于view的左边缘（left）和view的内容的左边缘在水平方向上的距离，mScrollY同理。<strong>scrollTo/scrollBy只能改变view的内容位置而不能改变view在布局中的位置。</strong></p>
<h3 id="使用动画"><a href="#使用动画" class="headerlink" title="使用动画"></a>使用动画</h3><p>　　使用动画使view平移的方式有两种：</p>
<ul>
<li><p>补间动画：实际上是对view的影像进行操作，并不会改变view本身的位置、内容等参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TranslateAnimation animation = <span class="keyword">new</span> TranslateAnimation(<span class="number">0</span>,<span class="number">100</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">setAnimation(animation);</span><br><span class="line">animation.start();</span><br></pre></td></tr></table></figure>
</li>
<li><p>属性动画：直接操作view的属性，可以改变view自身。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator.ofInt(targetView,<span class="string">"translationX"</span>,<span class="number">0</span>,<span class="number">100</span>).setDuration(<span class="number">500</span>).start();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="改变LayoutParams"><a href="#改变LayoutParams" class="headerlink" title="改变LayoutParams"></a>改变LayoutParams</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">        ViewGroup.MarginLayoutParams params = (ViewGroup.MarginLayoutParams) getLayoutParams();</span><br><span class="line">        params.leftMargin += <span class="number">100</span>;</span><br><span class="line">        setLayoutParams(params);</span><br><span class="line"><span class="comment">//      或requestLayout();</span></span><br></pre></td></tr></table></figure>
<h2 id="弹性滑动"><a href="#弹性滑动" class="headerlink" title="弹性滑动"></a>弹性滑动</h2><h3 id="使用Scroller"><a href="#使用Scroller" class="headerlink" title="使用Scroller"></a>使用Scroller</h3><p>　　Scroller的典型用法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">scroller = <span class="keyword">new</span> Scroller(getContext());</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">smoothScrollTo</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> scrollX = getScrollX();</span><br><span class="line">        <span class="keyword">int</span> delayX = x - scrollX;</span><br><span class="line">        scroller.startScroll(scrollX, <span class="number">0</span>, delayX, <span class="number">0</span>, <span class="number">1000</span>);<span class="comment">//仅仅保存相应参数</span></span><br><span class="line">        invalidate();<span class="comment">//draw方法中会调用computeScroll</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (scroller.computeScrollOffset()) &#123;</span><br><span class="line">            scrollTo(scroller.getCurrX(), scroller.getCurrY());</span><br><span class="line">            postInvalidate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>　　Scroller本身并不能使View滑动，它需要配合View的computeScroll方法才能实现弹性滑动的效果。它不断让view重绘，每一次重绘距离view的起始滑动会有一个时间间隔，通过这个时间间隔Scroller可以得到view的当前滑动位置，通过scrollTo()完成滑动。</p>
<h3 id="使用属性动画"><a href="#使用属性动画" class="headerlink" title="使用属性动画"></a>使用属性动画</h3><p>　　值动画：其实属性动画的根本就是属性<strong>值的改变</strong>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ValueAnimator animator = ValueAnimator.ofFloat(<span class="number">0</span>,<span class="number">1</span>).setDuration(<span class="number">1000</span>);</span><br><span class="line">      animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">              <span class="keyword">float</span> flag = animation.getAnimatedFraction();</span><br><span class="line">              scrollTo(startX + (<span class="keyword">int</span>)(delayX * flag),<span class="number">0</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      animator.start();</span><br></pre></td></tr></table></figure></p>
<p>　　其实所谓弹性滑动，就是将一次滑动分成了若干个短距离滑动。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/Pl2303笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风少侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风少侠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/Pl2303笔记/" itemprop="url">Pl2303笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T12:24:20+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基本了解"><a href="#基本了解" class="headerlink" title="基本了解"></a>基本了解</h1><p>  PL2303 是Prolific 公司生产的一种高度集成的RS232-USB接口转换器，可提供一个RS232 全双工异步串行通信装置与USB 功能接口便利连接的解决方案。</p>
<h1 id="类简介"><a href="#类简介" class="headerlink" title="类简介"></a>类简介</h1><ul>
<li>PL2303MultiLib：主类，里面包括连接设备、数据传输等很多操作方法。</li>
<li>PL2303MultiLib.BaudRate：波特率（枚举类）</li>
<li>PL2303MultiLib.DataBits：数据位（枚举类）</li>
<li>PL2303MultiLib.FlowControl：流量控制（枚举类）</li>
<li>PL2303MultiLib.Parity：（枚举类）</li>
<li>PL2303MultiLib.StopBits：停止位（枚举类）</li>
</ul>
<h1 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*Initialize a PL2303HXD driver, the software 4K Queue buffer is enable.内部调用下面的构造方法，默认第四个参数bWithQueue为true。第三个参数sAppName为芯片内部一个广播接收器的过滤器的ACTION，应该随便一个字符串就行（官方给出的案例用的是</span></span><br><span class="line"><span class="comment">private static final String ACTION_USB_PERMISSION = "com.prolific.pluartmultisimpletest.USB_PERMISSION";）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PL2303MultiLib</span><span class="params">(UsbManager manager, Context context, java.lang.String sAppName)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Initialize a PL2303HXD driver</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PL2303MultiLib</span><span class="params">(UsbManager manager, Context context, java.lang.String sAppName, <span class="keyword">boolean</span> bWithQueue)</span></span></span><br></pre></td></tr></table></figure>
<h1 id="常用参数和方法"><a href="#常用参数和方法" class="headerlink" title="常用参数和方法"></a>常用参数和方法</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PL2303芯片发送广播通知的IntentFilter.Action</span></span><br><span class="line"><span class="keyword">public</span> String PLUART_MESSAGE = <span class="string">"tw.PL2303MultiUSBMessage"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//检测到Usb设备拔出时，发送的广播所携带的extra数据，为String格式的device index。</span></span><br><span class="line"><span class="keyword">public</span> String PLUART_DETACHED = <span class="string">"MultiUSB.Detached"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//返回PL2303HXD device数量，默认的VID_PID为067B_2303。同时会进行一些初始化工作，例如注册广播等。</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">PL2303Enumerate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过device index获取该PL2303HXD的连接状态，如果连接成功返回true，否则返回false。</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">PL2303IsDeviceConnectedByIndex</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过URAT设置打开一个PL-UART USB device，成功打开则返回true。第一个参数为设备的index，后面四个为相应的枚举参数</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">PL2303OpenDevByUARTSetting</span><span class="params">(<span class="keyword">int</span> index, BaudRate R, DataBits D, StopBits S, Parity P, FlowControl F)</span> </span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//写入字节数据到PL-UART芯片集。返回写入数据的长度。</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">PL2303Write</span><span class="params">(<span class="keyword">int</span> index,<span class="keyword">byte</span>[] buf)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//从PL-UART芯片读取数据。返回读取数据的长度。读取到的数据会存在buf字节数组中。</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">PL2303Read</span><span class="params">(<span class="keyword">int</span> index,<span class="keyword">byte</span>[] buf)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭一个PL-UART芯片集</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PL2303Release</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>　　官方给出的demo做了以下配置：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity android:name=<span class="string">".PL2303Activity"</span> android:launchMode=<span class="string">"singleTop"</span>&gt;</span><br><span class="line"></span><br><span class="line">            &lt;meta-data android:name=<span class="string">"android.hardware.usb.action.USB_DEVICE_ATTACHED"</span></span><br><span class="line">                android:resource=<span class="string">"@xml/device_filter"</span> /&gt;</span><br><span class="line">&lt;/activity&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//device_filter</span></span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;resources&gt;</span><br><span class="line">		&lt;usb-device vendor-id=<span class="string">"1659"</span> product-id=<span class="string">"8963"</span> /&gt;</span><br><span class="line">		&lt;usb-device vendor-id=<span class="string">"1659"</span> product-id=<span class="string">"9553"</span> /&gt;</span><br><span class="line">		&lt;usb-device vendor-id=<span class="string">"1659"</span> product-id=<span class="string">"8964"</span> /&gt;   </span><br><span class="line">		&lt;usb-device vendor-id=<span class="string">"1659"</span> product-id=<span class="string">"9475"</span> /&gt;</span><br><span class="line">&lt;!-- usb-device vendor-id=<span class="string">"1659=0x067B"</span> product-id=<span class="string">"8963=0x2303"</span> --&gt;</span><br><span class="line">&lt;!-- usb-device vendor-id=<span class="string">"1659=0x067B"</span> product-id=<span class="string">"9553=0x2551"</span> --&gt;</span><br><span class="line">&lt;!-- usb-device vendor-id=<span class="string">"1659=0x067B"</span> product-id=<span class="string">"8964=0x2304"</span> --&gt;</span><br><span class="line">&lt;!-- usb-device vendor-id=<span class="string">"1659=0x067B"</span> product-id=<span class="string">"9475=0x2503"</span> --&gt;</span><br><span class="line">&lt;/resources&gt;</span><br></pre></td></tr></table></figure></p>
<p>　　不过本人实测，单串口通信时不配置这个也能走通，貌似代码中自己添加了相关参数：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这其实是个构造函数，混淆过的源码 - -#</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">(UsbManager var1, Context var2, String var3, <span class="keyword">boolean</span> var4)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.U = var1;</span><br><span class="line">        <span class="keyword">this</span>.a = var2;</span><br><span class="line">        <span class="keyword">this</span>.V = var3;</span><br><span class="line">        <span class="keyword">this</span>.W.add(<span class="string">"067B:2303"</span>);<span class="comment">//这里其实就是device_filter中的参数</span></span><br><span class="line">        <span class="keyword">this</span>.W.add(<span class="string">"067B:2551"</span>);</span><br><span class="line">        <span class="keyword">this</span>.W.add(<span class="string">"067B:2503"</span>);</span><br><span class="line">        <span class="keyword">this</span>.W.add(<span class="string">"067B:AAA5"</span>);</span><br><span class="line">        <span class="keyword">this</span>.W.add(<span class="string">"05AD:0FBA"</span>);</span><br><span class="line">        <span class="keyword">this</span>.a(<span class="string">"067B:2304"</span>);</span><br><span class="line">        <span class="keyword">this</span>.X = <span class="keyword">this</span>.W.size();</span><br><span class="line">        <span class="keyword">this</span>.ab = <span class="keyword">new</span> UsbDeviceInfo[<span class="number">4</span>];</span><br><span class="line">        <span class="keyword">this</span>.ad = <span class="keyword">new</span> PL2303MultiLib.a[<span class="number">4</span>];</span><br></pre></td></tr></table></figure></p>
<p>　　至于多串口通信，没做过多测试，而且最后还留了个坑。</p>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一步：得到PL2303MultiLib对象</span></span><br><span class="line">PL2303MultiLib mSerialMulti = <span class="keyword">new</span> PL2303MultiLib((UsbManager)mcontext.getSystemService(Context.USB_SERVICE),mcontext, ACTION_USB_PERMISSION);</span><br><span class="line"><span class="comment">//第二步：得到可用的device数目,注册广播接收器,监听一些状态变化（看源码貌似只发送了USB的DETACHED广播，extra数据为device index）</span></span><br><span class="line"><span class="keyword">int</span> iDeviceCount = mSerialMulti.PL2303Enumerate();</span><br><span class="line"><span class="keyword">if</span>(iDeviceCount &gt; <span class="number">0</span>)&#123;</span><br><span class="line">  IntentFilter filter = <span class="keyword">new</span> IntentFilter();</span><br><span class="line">  filter.addAction(mSerialMulti.PLUART_MESSAGE);</span><br><span class="line">  registerReceiver(PLMultiLibReceiver, filter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//第三步：打开usb device，进行相关的读写操作（第一个参数为自定义的index，后续需要与该device通信时传该index）</span></span><br><span class="line"><span class="keyword">boolean</span> res = mSerialMulti.PL2303OpenDevByUARTSetting(DeviceIndex, mBaudrate,mDataBits, mStopBits, mParity, mFlowControl);</span><br><span class="line"><span class="keyword">if</span>(res)&#123;</span><br><span class="line">	<span class="comment">//todo  读写操作</span></span><br><span class="line">	<span class="comment">//读（一般用子线程无线循环进行操作，官方案例间隔60ms）</span></span><br><span class="line">	ReadLoop1.start();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//第四步：所有操作结束后释放相关资源</span></span><br><span class="line"><span class="keyword">if</span> (mSerialMulti != <span class="keyword">null</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span> (iDeviceCount &gt; <span class="number">0</span>)</span><br><span class="line">      mcontext.unregisterReceiver(PLMultiLibReceiver);</span><br><span class="line">   mSerialMulti.PL2303Release();</span><br><span class="line">   mSerialMulti = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//读取数据的线程</span></span><br><span class="line">    <span class="keyword">private</span> Runnable ReadLoop1 = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            	ReadLen1 = mSerialMulti.PL2303Read(DeviceIndex1, ReadBuf1);</span><br><span class="line">                <span class="keyword">if</span> (ReadLen1 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//ReadBuf1[ReadLen1] = 0;                	</span></span><br><span class="line">                 	mHandler1.post(<span class="keyword">new</span> Runnable() &#123;                 		</span><br><span class="line">                 		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                 			StringBuffer sbHex=<span class="keyword">new</span> StringBuffer();</span><br><span class="line">                 	         <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; ReadLen1; j++) &#123;            	   </span><br><span class="line">                 	        	 sbHex.append((<span class="keyword">char</span>) (ReadBuf1[j]&amp;<span class="number">0x000000FF</span>));</span><br><span class="line">                             &#125;              </span><br><span class="line">                 	         tvRead1.setText(sbHex.toString());</span><br><span class="line">                 	         svReadView1.fullScroll(ScrollView.FOCUS_DOWN);</span><br><span class="line">                 		&#125;</span><br><span class="line">                 	&#125;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                DelayTime(<span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (stop) &#123;</span><br><span class="line">                	<span class="keyword">return</span>;</span><br><span class="line">                &#125;               </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<h1 id="暂留个坑"><a href="#暂留个坑" class="headerlink" title="暂留个坑"></a>暂留个坑</h1><p>　　在实际使用的时候遇到这么个问题，我自己是用的anroid作为上位机，如果单串口通信，则一切正常；多个串口通信时，（在部分手机或者网络盒子上）必须先连接好一个usb接口，成功后再连接另一个，如果同时打开进行连接会发生crash，错误日志是usbdevice.getDeviceInterfaceCount为0，应该是国内各种自定义系统的原因，但是还没找到正确的解决办法。如果有知道的大神希望不吝赐教。或者等过段时间我自己搞明白了会亲手填上这个坑。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/Android小知识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风少侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风少侠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/Android小知识/" itemprop="url">Android小知识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T12:22:32+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>自己在开发过程中积累的一些小知识点，持续更新，留个记录。</p>
<h1 id="TintContextWrapper-cannot-be-cast-to-Activity"><a href="#TintContextWrapper-cannot-be-cast-to-Activity" class="headerlink" title="TintContextWrapper cannot be cast to Activity"></a>TintContextWrapper cannot be cast to Activity</h1><p>　　比如有这样一个需求，在一个view的点击事件中来操作activity的方法，假如这个点击事件写在activity外面（比如DataBinding模式中写在model里面），就像这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">	Activity activity = (Activity)view.getContext();</span><br><span class="line">	activity.finish();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　使用这种方法会报这样一个crash：</p>
<blockquote>
<p>android.support.v7.widget.TintContextWrapper cannot be cast to Activity</p>
</blockquote>
<p>　  解决方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Activity <span class="title">getRequiredActivity</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Context context = view.getContext();</span><br><span class="line">        <span class="keyword">while</span> (context <span class="keyword">instanceof</span> ContextWrapper) &#123;</span><br><span class="line">            <span class="keyword">if</span> (context <span class="keyword">instanceof</span> Activity) &#123;</span><br><span class="line">                <span class="keyword">return</span> (Activity) context;</span><br><span class="line">            &#125;</span><br><span class="line">            context = ((ContextWrapper) context).getBaseContext();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="String-format-String-Object…"><a href="#String-format-String-Object…" class="headerlink" title="String.format(String,Object…)"></a>String.format(String,Object…)</h1><p>　　如果想在android中使用占位符，可以这么写：%[index]$[type]。index表示对应第index个资源，从1开始；type表示资源类型，常见的有这几种：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>s</td>
<td>字符串</td>
</tr>
<tr>
<td>c</td>
<td>字符</td>
</tr>
<tr>
<td>b</td>
<td>布尔</td>
</tr>
<tr>
<td>d</td>
<td>十进制整型</td>
</tr>
<tr>
<td>x</td>
<td>十六进制整型</td>
</tr>
<tr>
<td>o</td>
<td>八进制整型</td>
</tr>
<tr>
<td>f</td>
<td>浮点类型</td>
</tr>
<tr>
<td>a</td>
<td>十六进制浮点类型</td>
</tr>
<tr>
<td>e</td>
<td>指数类型</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;string name="letChessItem"&gt;19路围棋，让%1$d子&lt;/string&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//databinding中使用，效果为19路围棋，让2子</span></span><br><span class="line">android:text=<span class="string">"@&#123;String.format(@string/letChessItem,2)&#125;"</span></span><br></pre></td></tr></table></figure>
<h1 id="AS使用正式签名进行调试"><a href="#AS使用正式签名进行调试" class="headerlink" title="AS使用正式签名进行调试"></a>AS使用正式签名进行调试</h1><p>　　集成微信登陆的时候用到过，使用方式，在主module的build文件中加入以下代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">			<span class="comment">//签名文件</span></span><br><span class="line">            <span class="function">storeFile <span class="title">file</span><span class="params">(<span class="string">'C:/Users/lxf/Desktop/mygo.keystore'</span>)</span></span></span><br><span class="line"><span class="function">			<span class="comment">//密码</span></span></span><br><span class="line"><span class="function">            storePassword "dswybs*OK"</span></span><br><span class="line"><span class="function">			<span class="comment">//别名</span></span></span><br><span class="line"><span class="function">            keyAlias "mygo"</span></span><br><span class="line"><span class="function">			<span class="comment">//别名密码</span></span></span><br><span class="line"><span class="function">            keyPassword "dswybs*OK"</span></span><br><span class="line"><span class="function">        &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">buildTypes </span>&#123;</span><br><span class="line">        debug &#123;</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">        &#125;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            <span class="function">proguardFiles <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android.txt'</span>)</span>, 'proguard-rules.pro'</span></span><br><span class="line"><span class="function">        &#125;</span></span><br><span class="line"><span class="function">    &#125;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="AS添加本地aar包作为依赖"><a href="#AS添加本地aar包作为依赖" class="headerlink" title="AS添加本地aar包作为依赖"></a>AS添加本地aar包作为依赖</h1><ol>
<li>在Module中建立”libs”目录(如果没有的话)</li>
<li>把aar文件拷入libs目录(假设为abc.aar)</li>
<li>在主module的build.gradle中加入：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   repositories &#123;</span><br><span class="line"></span><br><span class="line">   	flatDir &#123;</span><br><span class="line">   		dirs <span class="string">'libs'</span></span><br><span class="line">   	&#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">compile(name:<span class="string">'abc'</span>,ext:<span class="string">'aar'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Unicode和中文相互转换"><a href="#Unicode和中文相互转换" class="headerlink" title="Unicode和中文相互转换"></a>Unicode和中文相互转换</h1><p>　　Unicode转中文<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">decode</span><span class="params">(String unicodeStr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (unicodeStr == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer retBuf = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">int</span> maxLoop = unicodeStr.length();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; maxLoop; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (unicodeStr.charAt(i) == <span class="string">'\\'</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((i &lt; maxLoop - <span class="number">5</span>) &amp;&amp; ((unicodeStr.charAt(i + <span class="number">1</span>) == <span class="string">'u'</span>) || (unicodeStr.charAt(i + <span class="number">1</span>) == <span class="string">'U'</span>)))</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        retBuf.append((<span class="keyword">char</span>) Integer.parseInt(unicodeStr.substring(i + <span class="number">2</span>, i + <span class="number">6</span>), <span class="number">16</span>));</span><br><span class="line">                        i += <span class="number">5</span>;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (NumberFormatException localNumberFormatException) &#123;</span><br><span class="line">                        retBuf.append(unicodeStr.charAt(i));</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    retBuf.append(unicodeStr.charAt(i));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                retBuf.append(unicodeStr.charAt(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> retBuf.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>　　中文转Unicode<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">gbEncoding</span><span class="params">(<span class="keyword">final</span> String gbString)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">char</span>[] utfBytes = gbString.toCharArray();  </span><br><span class="line">        String unicodeBytes = <span class="string">""</span>;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> byteIndex = <span class="number">0</span>; byteIndex &lt; utfBytes.length; byteIndex++) &#123;  </span><br><span class="line">            String hexB = Integer.toHexString(utfBytes[byteIndex]);  </span><br><span class="line">            <span class="keyword">if</span> (hexB.length() &lt;= <span class="number">2</span>) &#123;  </span><br><span class="line">                hexB = <span class="string">"00"</span> + hexB;  </span><br><span class="line">            &#125;  </span><br><span class="line">            unicodeBytes = unicodeBytes + <span class="string">"\\u"</span> + hexB;  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.out.println(<span class="string">"unicodeBytes is: "</span> + unicodeBytes);  </span><br><span class="line">        <span class="keyword">return</span> unicodeBytes;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="Plugin-Error（2017-2-7更新）"><a href="#Plugin-Error（2017-2-7更新）" class="headerlink" title="Plugin Error（2017.2.7更新）"></a>Plugin Error（2017.2.7更新）</h1><p>　　Android Studio有时候启动会莫名的报plugin error错误，Problems found loading plugins:  各种”Android Support is disabled”。即插件找不到，解决办法如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-ec4d621085495d82.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AS设置.png"></p>
<p>　　重新勾选Android Support插件即可，如果是其他插件找不到，即重新启动对应插件。</p>
<h1 id="textview代码动态设置drawable（2017-2-10更新）"><a href="#textview代码动态设置drawable（2017-2-10更新）" class="headerlink" title="textview代码动态设置drawable（2017.2.10更新）"></a>textview代码动态设置drawable（2017.2.10更新）</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Drawable drawable = getResources().getDrawable(icons[random.nextInt(icons.length)]);</span><br><span class="line"><span class="comment">//这句话必须加，否则drawable不会显示，官方文档特意说明的</span></span><br><span class="line">drawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, drawable.getMinimumWidth(), drawable.getMinimumHeight());</span><br><span class="line">tv_first.setCompoundDrawables(<span class="keyword">null</span>, drawable, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">tv_first.setCompoundDrawablePadding((<span class="keyword">int</span>) DensityUtils.dp2px(context, <span class="number">10f</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line"><span class="comment">//tv_first.setCompoundDrawablesWithIntrinsicBounds(null, getResources().getDrawable(icons[random.nextInt(icons.length)]), null, null);</span></span><br></pre></td></tr></table></figure>
<h1 id="数组复制（2017-2-15更新）"><a href="#数组复制（2017-2-15更新）" class="headerlink" title="数组复制（2017.2.15更新）"></a>数组复制（2017.2.15更新）</h1><p>　　避免使用for循环去自己实现，且系统自带的方法很多底层用c++实现的，效率更高。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.源数组 2.源数组的起始位置 3.目标数组  4.目标数组的起始位置 5.需要复制的长度</span></span><br><span class="line">System.arraycopy(currSolves, <span class="number">1</span>, solves, <span class="number">0</span>, solves.length);</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/MVVM之DataBinding学习笔记（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风少侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风少侠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/MVVM之DataBinding学习笔记（二）/" itemprop="url">MVVM之DataBinding学习笔记（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T12:09:43+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="进阶使用"><a href="#进阶使用" class="headerlink" title="进阶使用"></a>进阶使用</h1><h2 id="数据更新"><a href="#数据更新" class="headerlink" title="数据更新"></a>数据更新</h2><p>　　在很多情况下，我们需要动态去设置相关数据，DataBinding为我们提供了两种方式来实现它。<br>　　<strong>方法一</strong></p>
<ol>
<li>实体类继承BaseObservable，或者自己实现Observable</li>
<li>在需要刷新的属性的get方法上添加@Bindable注解，此时会自动生成BR类。（这里有个坑，很多时候BR文件不会自动生成，此时需要重启AS…请让我先默默地日一波dog）</li>
<li>在相应的set方法里调用notifyPropertyChanged(BR.xxx)进行刷新。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lxf.androiddemos.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.databinding.BaseObservable;</span><br><span class="line"><span class="keyword">import</span> android.databinding.Bindable;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lxf.androiddemos.BR;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserEntity</span> <span class="keyword">extends</span> <span class="title">BaseObservable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAge</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        setAge(getAge() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bindable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line"><span class="comment">//        notifyChange();//刷新所有可刷新数据</span></span><br><span class="line">        notifyPropertyChanged(BR.age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>　　<strong>方法二</strong></p>
<ol>
<li>实体类继承BaseObservable，或者自己实现Observable</li>
<li>使用ObservableField&lt;&gt;，泛型可以填入自己需要的类型，注意必须要初始化。对于基本数据类型也可以直接使用ObservableBoolean, ObservableByte, ObservableChar, ObservableShort, ObservableInt, ObservableLong, ObservableFloat, ObservableDouble和ObservableParcelable。</li>
<li>通过set和get方法为ObservableField设值和取值</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lxf.androiddemos.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.databinding.BaseObservable;</span><br><span class="line"><span class="keyword">import</span> android.databinding.ObservableField;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserEntity</span> <span class="keyword">extends</span> <span class="title">BaseObservable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ObservableField&lt;String&gt; address = <span class="keyword">new</span> ObservableField&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeAddress</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        address.set(<span class="string">"change:"</span> + address.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义属性绑定适配器和回调"><a href="#自定义属性绑定适配器和回调" class="headerlink" title="自定义属性绑定适配器和回调"></a>自定义属性绑定适配器和回调</h2><h3 id="自动寻找setter"><a href="#自动寻找setter" class="headerlink" title="自动寻找setter"></a>自动寻找setter</h3><p>　　DataBinding在遇到属性绑定时，会自动去寻找该属性的set方法，找到就会调用，找不到就报错。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ImageView</span><br><span class="line">    android:layout_width=<span class="string">"50dp"</span></span><br><span class="line">    android:layout_height=<span class="string">"50dp"</span></span><br><span class="line">    app:imageResource=<span class="string">"@&#123;R.mipmap.ic_launcher&#125;"</span>/&gt;</span><br></pre></td></tr></table></figure></p>
<p>　　比如上面这段代码，我们知道ImageView中是没有imageResource这个属性的，但是有setImageResource(int resId)方法，因此这段代码是可以正常运行的。利用这种特性，可以为一些自定义控件增加setter方法，使其支持DataBinding。</p>
<h3 id="BindingMethods"><a href="#BindingMethods" class="headerlink" title="@BindingMethods"></a>@BindingMethods</h3><p>　　当xml属性名称和源码中set方法名称不一致时，可以通过这种方式来进行绑定。先看一个官方的实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingMethods</span>(&#123;</span><br><span class="line">		...</span><br><span class="line">        <span class="meta">@BindingMethod</span>(type = TextView.class, attribute = <span class="string">"android:inputType"</span>, method = <span class="string">"setRawInputType"</span>),</span><br><span class="line">		...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>　　这段代码的意思就是将TextView的android:inputType属性绑定到setRawInputType方法，其实也可以通俗的认为是为原本的setter方法起了一个别名。</p>
<h3 id="BindingAdapter"><a href="#BindingAdapter" class="headerlink" title="@BindingAdapter"></a>@BindingAdapter</h3><p>　　很多时候，源码中并没有提供set方法，比如ImageView，我们希望通过设置url来达到加载图片的目的，我们可以通过@BindAdapter来实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;layout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:app=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--如果本页不需要绑定数据，data标签可以省略--&gt;</span><br><span class="line">    &lt;data <span class="class"><span class="keyword">class</span></span>=<span class="string">"DataBingMain"</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">import</span> type=<span class="string">"lxf.androiddemos.R"</span>/&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=<span class="string">"user"</span></span><br><span class="line">            type=<span class="string">"lxf.androiddemos.model.UserEntity"</span>/&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        ...</span><br><span class="line">        &gt;</span><br><span class="line"></span><br><span class="line">        &lt;ImageView</span><br><span class="line">            android:layout_width=<span class="string">"100dp"</span></span><br><span class="line">            android:layout_height=<span class="string">"100dp"</span></span><br><span class="line">            app:url=<span class="string">"@&#123;user.img&#125;"</span></span><br><span class="line">            app:placeHolder=<span class="string">"@&#123;R.mipmap.ic_launcher&#125;"</span>/&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">&lt;/layout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserEntity</span> <span class="keyword">extends</span> <span class="title">BaseObservable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String img;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BindingAdapter</span>(value = &#123;<span class="string">"url"</span>,<span class="string">"placeHolder"</span>&#125;,requireAll = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setImage</span><span class="params">(ImageView imageView ,String url,<span class="keyword">int</span> placeHolder)</span></span>&#123;</span><br><span class="line">        Glide.with(imageView.getContext()).load(url).placeholder(placeHolder).into(imageView);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里有几点需要注意：</p>
<ul>
<li>xml文件中一定不要忘记各种类的import（除java.lang包外均需导入），否则你一定会碰到databinding程序包不存在这个错误。</li>
<li>设置@BindAdapter注解的方法需要是static的，否则编译也会报错。</li>
<li>你可以把这个方法设置在一个专门的工具类中，不是说必须要在这个model实体类里。</li>
<li>@BindAdapter包含value和requireAll两个属性，value是一个String[]，包含你自定义的属性。requireAll意思是是否需要设置你在value中声明的全部属性，默认为true。如果设定为false，那么没赋值的自定义属性会传默认值。</li>
</ul>
<p>　　到这里，我们来回头看一下之前在<strong>事件绑定</strong>中留下的那个坑——onTextChanged，其实这是官方提前为我们封装好的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter</span>(value = &#123;<span class="string">"android:beforeTextChanged"</span>, <span class="string">"android:onTextChanged"</span>,</span><br><span class="line">            <span class="string">"android:afterTextChanged"</span>, <span class="string">"android:textAttrChanged"</span>&#125;, requireAll = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setTextWatcher</span><span class="params">(TextView view, <span class="keyword">final</span> BeforeTextChanged before,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> OnTextChanged on, <span class="keyword">final</span> AfterTextChanged after,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> InverseBindingListener textAttrChanged)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> TextWatcher newValue;</span><br><span class="line">        <span class="keyword">if</span> (before == <span class="keyword">null</span> &amp;&amp; after == <span class="keyword">null</span> &amp;&amp; on == <span class="keyword">null</span> &amp;&amp; textAttrChanged == <span class="keyword">null</span>) &#123;</span><br><span class="line">            newValue = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newValue = <span class="keyword">new</span> TextWatcher() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> count, <span class="keyword">int</span> after)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (before != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        before.beforeTextChanged(s, start, count, after);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (on != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        on.onTextChanged(s, start, before, count);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (textAttrChanged != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        textAttrChanged.onChange();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (after != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        after.afterTextChanged(s);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> TextWatcher oldValue = ListenerUtil.trackListener(view, newValue, R.id.textWatcher);</span><br><span class="line">        <span class="keyword">if</span> (oldValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">            view.removeTextChangedListener(oldValue);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (newValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">            view.addTextChangedListener(newValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>　　可以看到，当on!=null时，会调用传统的onTextChanged方法。</p>
<h3 id="BindingConversion"><a href="#BindingConversion" class="headerlink" title="@BindingConversion"></a>@BindingConversion</h3><p>　　方法注释，当自定义的属性和setter方法中需要的参数类型不符时进行转换。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:background=<span class="string">"@&#123;`#de325e`&#125;"</span></span><br><span class="line">    /&gt;</span><br></pre></td></tr></table></figure></p>
<p>　　上面这种写法，直接编译是会报错的，因为setBackground接收的是一个Drawable对象，而我们传入的是个string，所以我们此处可以用@BindingConversion来转换一下（PS：我知道传统写法是可以直接传字符串颜色值的，我只是举个简单例子）。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingConversion</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Drawable <span class="title">colorToDrawable</span><span class="params">(String color)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ColorDrawable(Color.parseColor(color));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　DataBinding在碰到这种参数类型不对的问题时，会自动去检索看看有没有相关的@BindingConversion方法，如果有的话则会调用，需要注意，这个方法也需要是static的。</p>
<h2 id="接口回调"><a href="#接口回调" class="headerlink" title="接口回调"></a>接口回调</h2><h3 id="model的回调"><a href="#model的回调" class="headerlink" title="model的回调"></a>model的回调</h3><p>　　当属性值变化时的回调。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user.addOnPropertyChangedCallback(<span class="keyword">new</span> Observable.OnPropertyChangedCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPropertyChanged</span><span class="params">(Observable sender, <span class="keyword">int</span> propertyId)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (propertyId == BR.age)&#123;</span><br><span class="line">                    Toast.makeText(getApplicationContext(),<span class="string">"age刷新了"</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="ViewDatabinding的回调"><a href="#ViewDatabinding的回调" class="headerlink" title="ViewDatabinding的回调"></a>ViewDatabinding的回调</h3><p>　　当ViewDataBinding执行executePendingBindings()尺寸必须再次评估时的回调。可以设置一些view的展示动画等。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dataBinding.addOnRebindCallback(<span class="keyword">new</span> OnRebindCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreBind</span><span class="params">(ViewDataBinding binding)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onPreBind(binding);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCanceled</span><span class="params">(ViewDataBinding binding)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.onCanceled(binding);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBound</span><span class="params">(ViewDataBinding binding)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.onBound(binding);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="双向绑定"><a href="#双向绑定" class="headerlink" title="双向绑定"></a>双向绑定</h2><h3 id="基本数据"><a href="#基本数据" class="headerlink" title="基本数据"></a>基本数据</h3><p>　　双向绑定意思不仅数据绑定UI，同时UI更新时可以刷新数据，语法为@={},举个例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditText</span><br><span class="line">          android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">          android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">          android:onTextChanged=<span class="string">"@&#123;util.onTextChanged&#125;"</span></span><br><span class="line">          android:text=<span class="string">"@=&#123;user.address&#125;"</span></span><br><span class="line">          /&gt;</span><br></pre></td></tr></table></figure></p>
<p>　　这样在程序运行后，editText会自动显示user.address的初始值，改变editText，则user.address也会同步改变，可以想象，如果我们将user.address绑定另一个TextView，则TextView的内容会跟随editText的变化而变化。</p>
<h3 id="隐式属性监听"><a href="#隐式属性监听" class="headerlink" title="隐式属性监听"></a>隐式属性监听</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;ImageView</span><br><span class="line">     android:layout_width=<span class="string">"100dp"</span></span><br><span class="line">     android:layout_height=<span class="string">"100dp"</span></span><br><span class="line">     android:visibility=<span class="string">"@&#123;checkbox.checked?View.VISIBLE:View.GONE&#125;"</span></span><br><span class="line">     app:placeHolder=<span class="string">"@&#123;R.mipmap.ic_launcher&#125;"</span></span><br><span class="line">     app:url=<span class="string">"@&#123;user.img&#125;"</span> /&gt;</span><br><span class="line"> &lt;CheckBox</span><br><span class="line">     android:id=<span class="string">"@+id/checkbox"</span></span><br><span class="line">     android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">     android:layout_height=<span class="string">"wrap_content"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>　　可以看ImageView的visibility属性，通过CheckBox的checked属性来控制自身的显示和隐藏，这是官方给出的一种支持，同时官方还支持下面这些属性：</p>
<ul>
<li><strong>AbsListView</strong> android:selectedItemPosition</li>
<li><strong>CalendarView</strong> android:date</li>
<li><strong>CompoundButton</strong> android:checked</li>
<li><strong>DatePicker</strong> android:year, android:month, android:day (yes, these are synthetic, but we had a listener, so we thought you’d want to use them)</li>
<li><strong>NumberPicker</strong> android:value</li>
<li><strong>RadioGroup</strong> android:checkedButton</li>
<li><strong>RatingBar</strong> android:rating</li>
<li><strong>SeekBar</strong> android:progress</li>
<li><strong>TabHost</strong> android:currentTab (you probably don’t care, but we had the listener)</li>
<li><strong>TextView</strong> android:text</li>
<li><strong>TimePicker</strong> android:hour, android:minute (again, synthetic, but we had the listener)</li>
</ul>
<h3 id="自定义双向绑定"><a href="#自定义双向绑定" class="headerlink" title="自定义双向绑定"></a>自定义双向绑定</h3><p>　　双向绑定其实就是正向绑定+反向绑定，前面讲的全部是正向绑定，截下来我们来看看怎么定义反向绑定。</p>
<h4 id="绑定方法（-InverseBindingMethods）"><a href="#绑定方法（-InverseBindingMethods）" class="headerlink" title="绑定方法（@InverseBindingMethods）"></a>绑定方法（@InverseBindingMethods）</h4><p>　　首先先来了解几个名词：</p>
<ul>
<li><p>@InverseBindingMethods：其实就是元素为@InverseBindingMethod的一个数组，用来注解<strong>类</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> InverseBindingMethods &#123;</span><br><span class="line">    InverseBindingMethod[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>@InverseBindingMethod：反向绑定方法，用来确定怎么去监听view属性的变化和回调哪一个getter方法。包含以下4个属性：</p>
<ul>
<li>type：包含attribute的view类型。</li>
<li>attribute:支持双向绑定的属性（string格式）。</li>
<li>event:可以省略，用来通知DataBinding系统attribute已经改变，默认为attribute + “AttrChanged”。（UI通知数据）</li>
<li>method:可以省略，用来从view获取数据的方法，不设定的话会自动寻找”is” 或 “get” + attribute方法。（数据刷新）</li>
</ul>
</li>
</ul>
<p>　　event调用时机需要通过@BindingAdapter进行设置。</p>
<ul>
<li>InverseBindingListener：反向绑定监听器，当使用双向绑定时，会在你的layout自动生成的binding类中自动生成一个InverseBindingListener的实现（拗口吗？好像有一点点。。不理解的可以去看看源码）。</li>
</ul>
<p>　　看完这几个名词是不是已经凌乱了？（话说我当时也差点哭了。。），我们来看个官方例子消化一下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@InverseBindingMethods</span>(&#123;</span><br><span class="line">        <span class="meta">@InverseBindingMethod</span>(type = CompoundButton.class, attribute = <span class="string">"android:checked"</span>),</span><br><span class="line">&#125;)<span class="comment">//1.这里需要双向绑定的是checked属性，event和method都省略了。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompoundButtonBindingAdapter</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">//2.设置什么时候调用event</span></span><br><span class="line">	<span class="meta">@BindingAdapter</span>(value = &#123;<span class="string">"android:onCheckedChanged"</span>, <span class="string">"android:checkedAttrChanged"</span>&#125;,</span><br><span class="line">            requireAll = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setListeners</span><span class="params">(CompoundButton view, <span class="keyword">final</span> OnCheckedChangeListener listener,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> InverseBindingListener attrChange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (attrChange == <span class="keyword">null</span>) &#123;</span><br><span class="line">            view.setOnCheckedChangeListener(listener);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            view.setOnCheckedChangeListener(<span class="keyword">new</span> OnCheckedChangeListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheckedChanged</span><span class="params">(CompoundButton buttonView, <span class="keyword">boolean</span> isChecked)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (listener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        listener.onCheckedChanged(buttonView, isChecked);</span><br><span class="line">                    &#125;</span><br><span class="line">                    attrChange.onChange();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//3.我们在layout中使用双向绑定</span></span><br><span class="line">		&lt;CheckBox</span><br><span class="line">            android:id=<span class="string">"@+id/checkbox"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:checked=<span class="string">"@=&#123;user.checked&#125;"</span>/&gt;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//4.layout的binding类中自动生成的InverseBindingListener实现。</span></span><br><span class="line">	<span class="comment">// Inverse Binding Event Handlers</span></span><br><span class="line">    <span class="keyword">private</span> android.databinding.InverseBindingListener checkboxandroidCheck = <span class="keyword">new</span> android.databinding.InverseBindingListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChange</span><span class="params">()</span> </span>&#123;<span class="comment">//这段逻辑其实就是用来更新user实体类中的checked字段的</span></span><br><span class="line">            <span class="comment">// Inverse of user.checked.get()</span></span><br><span class="line">            <span class="comment">//         is user.checked.set((java.lang.Boolean) callbackArg_0)</span></span><br><span class="line">            <span class="keyword">boolean</span> callbackArg_0 = checkbox.isChecked();<span class="comment">//其实就是method</span></span><br><span class="line">            <span class="comment">// localize variables for thread safety</span></span><br><span class="line">            <span class="comment">// user.checked != null</span></span><br><span class="line">            <span class="keyword">boolean</span> checkedUserObjectnul = <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">// user.checked</span></span><br><span class="line">            android.databinding.ObservableField&lt;java.lang.Boolean&gt; checkedUser = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">// user</span></span><br><span class="line">            lxf.androiddemos.model.UserEntity user = mUser;</span><br><span class="line">            <span class="comment">// user.checked.get()</span></span><br><span class="line">            java.lang.Boolean CheckedUser1 = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">// user != null</span></span><br><span class="line">            <span class="keyword">boolean</span> userObjectnull = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">            userObjectnull = (user) != (<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (userObjectnull) &#123;</span><br><span class="line">              checkedUser = user.checked;</span><br><span class="line"></span><br><span class="line">                checkedUserObjectnul = (checkedUser) != (<span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">if</span> (checkedUserObjectnul) &#123;</span><br><span class="line">                checkedUser.set((java.lang.Boolean) (callbackArg_0));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></p>
<p>　　整个反向绑定的流程下来其实就是：</p>
<ol>
<li>定义需要反向绑定的属性（checked），并配置event（checkedAttrChanged）和method（isChecked）。</li>
<li>系统会自动根据event找到对应的方法（setLinstener），配置好调用时机。</li>
<li>开发者在layout中使用双向绑定。</li>
<li>自动在binding类中生成一个InverseBindingListener的实现。<h4 id="绑定适配器（-InverseBindingAdapter）"><a href="#绑定适配器（-InverseBindingAdapter）" class="headerlink" title="绑定适配器（@InverseBindingAdapter）"></a>绑定适配器（@InverseBindingAdapter）</h4>　　下面再来看个新名词…( ╯□╰ )：</li>
</ol>
<ul>
<li>@InverseBindingAdapter：反向绑定适配器，用来注解<strong>方法</strong>。只包含attribute和event两个属性，含义同上：<ul>
<li>attribute：支持双向绑定的属性（string格式）。</li>
<li>event：可以省略，用来通知DataBinding系统attribute已经改变，默认为attribute + “AttrChanged”。需要通过@BindingAdapter进行设置调用时机。</li>
</ul>
</li>
</ul>
<p>　　@InverseBindingAdapter注解的方法本身就相当于获取数据的getter方法（类似于@BindingAdapter注解的方法本身就相当于setter方法）。</p>
<p>　　官方案例（双向绑定android:text）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.这一步相当于做了两个操作：确定绑定的属性和event；指定getter方法</span></span><br><span class="line"><span class="meta">@InverseBindingAdapter</span>(attribute = <span class="string">"android:text"</span>, event = <span class="string">"android:textAttrChanged"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTextString</span><span class="params">(TextView view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> view.getText().toString();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//2.根据event找到对应方法，配置event的调用时机。</span></span><br><span class="line"><span class="meta">@BindingAdapter</span>(value = &#123;<span class="string">"android:beforeTextChanged"</span>, <span class="string">"android:onTextChanged"</span>,</span><br><span class="line">            <span class="string">"android:afterTextChanged"</span>, <span class="string">"android:textAttrChanged"</span>&#125;, requireAll = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setTextWatcher</span><span class="params">(TextView view, <span class="keyword">final</span> BeforeTextChanged before,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> OnTextChanged on, <span class="keyword">final</span> AfterTextChanged after,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> InverseBindingListener textAttrChanged)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> TextWatcher newValue;</span><br><span class="line">        <span class="keyword">if</span> (before == <span class="keyword">null</span> &amp;&amp; after == <span class="keyword">null</span> &amp;&amp; on == <span class="keyword">null</span> &amp;&amp; textAttrChanged == <span class="keyword">null</span>) &#123;</span><br><span class="line">            newValue = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newValue = <span class="keyword">new</span> TextWatcher() &#123;</span><br><span class="line">                ...</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (on != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        on.onTextChanged(s, start, before, count);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (textAttrChanged != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        textAttrChanged.onChange();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                ....</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">       ...</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//3.使用双向绑定</span></span><br><span class="line">		&lt;EditText</span><br><span class="line">            android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:onTextChanged=<span class="string">"@&#123;util.onTextChanged&#125;"</span></span><br><span class="line">            android:text=<span class="string">"@=&#123;user.address&#125;"</span> /&gt;</span><br><span class="line">	<span class="comment">//4.binding类中自动生成InverseBindingListener的实现。</span></span><br><span class="line"><span class="keyword">private</span> android.databinding.InverseBindingListener mboundView10androidT = <span class="keyword">new</span> android.databinding.InverseBindingListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// Inverse of user.address.get()</span></span><br><span class="line">            <span class="comment">//         is user.address.set((java.lang.String) callbackArg_0)</span></span><br><span class="line">            java.lang.String callbackArg_0 = android.databinding.adapters.TextViewBindingAdapter.getTextString(mboundView10);<span class="comment">//getter方法</span></span><br><span class="line">            <span class="comment">// localize variables for thread safety</span></span><br><span class="line">            <span class="comment">// user.address != null</span></span><br><span class="line">            <span class="keyword">boolean</span> addressUserObjectnul = <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">// user</span></span><br><span class="line">            lxf.androiddemos.model.UserEntity user = mUser;</span><br><span class="line">            <span class="comment">// user.address</span></span><br><span class="line">            android.databinding.ObservableField&lt;java.lang.String&gt; addressUser = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">// user.address.get()</span></span><br><span class="line">            java.lang.String AddressUser1 = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">// user != null</span></span><br><span class="line">            <span class="keyword">boolean</span> userObjectnull = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">		  	userObjectnull = (user) != (<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (userObjectnull) &#123;</span><br><span class="line">                addressUser = user.address;</span><br><span class="line">                addressUserObjectnul = (addressUser) != (<span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">if</span> (addressUserObjectnul) &#123;</span><br><span class="line">					 addressUser.set((java.lang.String) (callbackArg_0));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></p>
<p>　　一大堆的代码看下来，其实绑定方法和绑定适配器两种方法的最终效果是一样的，实现过程也是大同小异，这里就不赘述了，和上面的绑定方法基本一致。</p>
<h4 id="比葫芦画瓢"><a href="#比葫芦画瓢" class="headerlink" title="比葫芦画瓢"></a>比葫芦画瓢</h4><p>　　我们来自定义实现这样一个效果，点击改变自定义view的颜色，同时将色值在另一个TextView中展示出来（虽然没什么卵用，仅仅当个案例吧），效果图如下（请自觉忽略其他的东西。。）：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-fad3579a6c47a687.gif?imageMogr2/auto-orient/strip" alt="效果图"></p>
<p>　　实现过程：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.自定义ColorPicker，并为color属性添加getter和setter方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPicker</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">private</span> String mColor;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(String mColor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mColor = mColor;</span><br><span class="line">        paint.setColor(Color.parseColor(mColor));</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.自定义反向绑定</span></span><br><span class="line"><span class="meta">@InverseBindingMethods</span>(&#123;</span><br><span class="line">        <span class="meta">@InverseBindingMethod</span>(type = ColorPicker.class,attribute = <span class="string">"color"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPickerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BindingAdapter</span>(value = &#123;<span class="string">"colorAttrChanged"</span>&#125;,requireAll = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">(ColorPicker picker, <span class="keyword">final</span> InverseBindingListener attrChange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (attrChange!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            picker.setOnColorChangeListener(<span class="keyword">new</span> ColorPicker.OnColorChangeListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onColorChange</span><span class="params">(ColorPicker picker, String color)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">                    attrChange.onChange();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3.在layout中使用双向绑定</span></span><br><span class="line">&lt;lxf.androiddemos.test.ColorPicker</span><br><span class="line">     android:layout_width=<span class="string">"100dp"</span></span><br><span class="line">     android:layout_height=<span class="string">"100dp"</span></span><br><span class="line">     app:color=<span class="string">"@=&#123;user.color&#125;"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>　　上面给出了关键代码，刚接触DataBinding的萌新如果理解不了可以去文末下载Demo看看，只是一个很简单的案例，应该没什么问题。<br>　　接下来我们用@InverseBindingAdapter来实现同样的效果：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPickerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InverseBindingAdapter</span>(attribute = <span class="string">"color"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getColor</span><span class="params">(ColorPicker picker)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> picker.getColor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BindingAdapter</span>(value = &#123;<span class="string">"colorAttrChanged"</span>&#125;,requireAll = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">(ColorPicker picker, <span class="keyword">final</span> InverseBindingListener attrChange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (attrChange!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            picker.setOnColorChangeListener(<span class="keyword">new</span> ColorPicker.OnColorChangeListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onColorChange</span><span class="params">(ColorPicker picker, String color)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">                    attrChange.onChange();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　另外关于一些情况下双向绑定存在的死循环问题，只要在setter方法中判断一下新老值不同即可。</p>
<h2 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h2><p>　　DataBindingComponent，一般用于一个@BindingAdapter方法需要有多种实现时（比如说测试。。），我们来看一下前面那个修改年龄age的例子：<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//原来的方式</span></span><br><span class="line">  <span class="meta">@BindingAdapter</span>(value = &#123;<span class="string">"url"</span>,<span class="string">"placeHolder"</span>&#125;,requireAll = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setImage</span><span class="params">(ImageView imageView , String url, <span class="keyword">int</span> placeHolder)</span></span>&#123;</span><br><span class="line">        ImgLoadUtil.load(imageView,url,placeHolder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运用DataBindingComponent</span></span><br><span class="line"><span class="comment">//1.如果需要多种实现，可以先建一个抽象的adapter，注意方法为非静态的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AppAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BindingAdapter</span>(value = &#123;<span class="string">"url"</span>,<span class="string">"placeHolder"</span>&#125;,requireAll = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setImage</span><span class="params">(ImageView imageView , String url, <span class="keyword">int</span> placeHolder)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.添加抽象adapter的实现，这里我们只写了一个</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImgAdapter</span> <span class="keyword">extends</span> <span class="title">AppAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImage</span><span class="params">(ImageView imageView, String url, <span class="keyword">int</span> placeHolder)</span> </span>&#123;</span><br><span class="line">        ImgLoadUtil.load(imageView,url,placeHolder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Img2Adapter</span> <span class="keyword">extends</span> <span class="title">AppAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImage</span><span class="params">(ImageView imageView, String url, <span class="keyword">int</span> placeHolder)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3.添加DataBindingComponent的实现（非静态的@BindingAdapter注解方法会自动在DataBindingComponent中生成相应的getter方法）。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">implements</span> <span class="title">android</span>.<span class="title">databinding</span>.<span class="title">DataBindingComponent</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AppAdapter <span class="title">getAppAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ImgAdapter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">My2Component</span> <span class="keyword">implements</span> <span class="title">android</span>.<span class="title">databinding</span>.<span class="title">DataBindingComponent</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AppAdapter <span class="title">getAppAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Img2Adapter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//4.Activity中调用</span></span><br><span class="line">        <span class="comment">//DataBingMain dataBinding = DataBindingUtil.setContentView(this, R.layout.activity_databinding);</span></span><br><span class="line">        <span class="comment">//DataBindingUtil.setDefaultComponent(new MyComponent());</span></span><br><span class="line">        DataBingMain dataBinding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_databinding,<span class="keyword">new</span> MyComponent());</span><br></pre></td></tr></table></figure></p>
<p> 　　最终效果是一模一样的。</p>
<h1 id="遇到的坑"><a href="#遇到的坑" class="headerlink" title="遇到的坑"></a>遇到的坑</h1><ul>
<li><p>Error:(8, 36) 错误: 程序包lxf.androiddemos.databinding不存在</p>
<blockquote>
<p>遇到这种情况一般都是xml中的问题，比如data标签中引入的包名不对，或者是布局里面使用了什么错误的属性，等等。。。数据量大的时候，这种错误一般比较难找，简直就是日了dog。</p>
</blockquote>
</li>
<li><p>需要更新数据时，为getter方法设置@Bindable，很多时候BR文件不会生成，需要重启AS，默默地再日一波dog。</p>
</li>
<li>最好不要使用clean project，否则R文件和BR文件会被清掉，R文件会自动重新生成，至于BR文件…那只dog，麻烦你再过来一下。</li>
</ul>
<hr>
<h1 id="更新（2018-1-5）"><a href="#更新（2018-1-5）" class="headerlink" title="更新（2018-1-5）"></a>更新（2018-1-5）</h1><p>最近打开一个历史项目，报了一堆BR文件找不到的异常，最终再错误日志的最后看到这么一个错误：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-775130717168c69d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="databinding.png"></p>
<p>查了好久最后发现是因为在xml文件里@{}代码块中使用了中文，貌似这个问题只有在window系统下会出现，记录一下，缅怀我失去的四五个小时。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cn.izis.util.ZYTextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"@&#123;`题目讲解:` + model.firstChess&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">"@color/title"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"18sp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">//正确写法</span><br><span class="line"><span class="tag">&lt;<span class="name">cn.izis.util.ZYTextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"@&#123;@string/courseTeach + model.firstChess&#125;"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">"@color/title"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"18sp"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Demo：</strong><a href="https://github.com/lunxinfeng/AndroidDemos" target="_blank" rel="noopener">此Demo会持续更新自己的学习历程，欢迎star</a><br><a href="http://msdx.github.io/androiddoc/docs/reference/android/databinding/Bindable.html" target="_blank" rel="noopener">官方文档</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/MVVM之DataBinding学习笔记（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风少侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风少侠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/MVVM之DataBinding学习笔记（一）/" itemprop="url">MVVM之DataBinding学习笔记（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T12:07:19+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>  …想了半分钟，好像并没有啥需要特别声明的，能翻到这篇文章的人，相信也早已了解了DataBinding是个什么东西，所以还是简单粗暴点儿，就当给自己留个笔记…开撸吧！</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><ul>
<li>确保sdk的support包更新到了最新版</li>
<li>在对应module的build.gradle文件中进行如下配置（需AS版本1.5以上）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    dataBinding &#123;</span><br><span class="line">        enabled = <span class="keyword">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><h2 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h2><h3 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h3><p>  <strong>先上layout代码</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;layout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!--如果本页不需要绑定数据，data标签可以省略--&gt;</span><br><span class="line">    &lt;data <span class="class"><span class="keyword">class</span></span>=<span class="string">"DataBingMain"</span>&gt;</span><br><span class="line">		&lt;<span class="keyword">import</span> type=<span class="string">"lxf.widget.util.AppUtils"</span>/&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=<span class="string">"user"</span></span><br><span class="line">            type=<span class="string">"lxf.androiddemos.model.UserEntity"</span>/&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></span><br><span class="line">        tools:context=<span class="string">"lxf.androiddemos.ui.DatabindingActivity"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">		android:padding=<span class="string">"16dp"</span></span><br><span class="line">        android:background=<span class="string">"@mipmap/bg_robot"</span></span><br><span class="line">        android:orientation=<span class="string">"vertical"</span></span><br><span class="line">        &gt;</span><br><span class="line">		&lt;TextView</span><br><span class="line">        	style=<span class="string">"@style/text_base"</span></span><br><span class="line">			android:text=<span class="string">"@&#123;`name:`+user.name&#125;"</span>/&gt;</span><br><span class="line">     	&lt;TextView</span><br><span class="line">            style=<span class="string">"@style/text_base"</span></span><br><span class="line">            android:text=<span class="string">"@&#123;user.sex&#125;"</span>/&gt;</span><br><span class="line">		&lt;TextView</span><br><span class="line">            style=<span class="string">"@style/text_base"</span></span><br><span class="line">            android:text=<span class="string">"@&#123;String.valueOf(user.age)&#125;"</span>/&gt;</span><br><span class="line">		&lt;TextView</span><br><span class="line">            style=<span class="string">"@style/text_base"</span></span><br><span class="line">            android:text=<span class="string">"@&#123;user.initType(user.type)&#125;"</span>/&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>layout的编写方式改变：新增layout和data标签，layout为根布局，包含data和ui布局两部分。data即要绑定的数据model，ui布局即我们以前写法中的根布局。</li>
<li>data标签：<ul>
<li>使用DataBinding编写布局，系统会自动生成一个继承ViewDataBinding类，而class属性可以指定这个类的名字，如果不指定，则会根据xml的名字自动生成。</li>
<li>variable可以设置多个。</li>
<li>通俗的讲，name即变量名，可以在下面直接引用，同时会在自动生成的ViewDataBinding类中自动生成setXXX和getXXX方法，用来绑定数据。</li>
<li>type即我们的数据model。</li>
<li>支持import，导入后可以在@{}中直接使用，方式同java。</li>
</ul>
</li>
<li>@{}语法中支持大部分的java操作，当然最好不要写太复杂的语句，如果有这个需求，可以在java类中写一个方法，然后在此调用：<ul>
<li>运算符： + - / * % () &amp;&amp; || &amp; | ^ &gt;&gt; &gt;&gt;&gt; &lt;&lt; == &gt; &lt; &gt;= &lt;=</li>
<li>字符串拼接 + (注意字符串要用``括起来，esc下面那个键)</li>
<li>instanceof</li>
<li>方法调用</li>
<li>res资源访问</li>
<li>数组访问 []</li>
<li>三目运算 表达式1 ? 表达式2 : 表达式3</li>
<li>聚合判断 表达式1 ?? 表达式2 （表达式1为null，则返回表达式2）</li>
<li>等等…</li>
</ul>
</li>
</ol>
<p>  <strong>activity代码</strong><br>　　通过DataBindingUtil.setContentView方法代替原来的setContentView。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//1.获取ViewDataBinding对象</span></span><br><span class="line">      DataBingMain dataBinding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_databinding);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//2.获取数据</span></span><br><span class="line">      UserEntity user = <span class="keyword">new</span> UserEntity();</span><br><span class="line">      user.setName(<span class="string">"lxf"</span>);</span><br><span class="line">      user.setSex(<span class="string">"man"</span>);</span><br><span class="line">      user.setAge(<span class="number">25</span>);</span><br><span class="line">      user.setType(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//3.绑定数据</span></span><br><span class="line">      dataBinding.setUser(user);</span><br><span class="line"><span class="comment">//dataBinding.setVariable(BR.user,user);</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>  <strong>model代码</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lxf.androiddemos.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserEntity</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">initType</span><span class="params">(<span class="keyword">int</span> type)</span></span>&#123;</span><br><span class="line">		String result;</span><br><span class="line">		<span class="keyword">switch</span> (type)&#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">				result = <span class="string">"程序猿"</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">				result = <span class="string">"程序猿的天敌"</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				result = <span class="string">"无业游民"</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//setter   getter方法略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>activity和model代码很简单，就不需要解释了。</p>
<h3 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h3><p>　　看到这里应该有个疑问：fragment中没有setContentView方法，该怎么办？<br>　　所幸DataBinding库还提供了另外一个初始化布局的方法：DataBindingUtil.inflate()。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></span><br><span class="line"><span class="function"><span class="params">                            Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       ViewDataBinding binding = DataBindingUtil.inflate(inflater,R.layout.fragment_blank,container,<span class="keyword">false</span>);</span><br><span class="line">       <span class="keyword">return</span> binding.getRoot();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>　　xml布局的写法同activity。</p>
<h2 id="列表绑定"><a href="#列表绑定" class="headerlink" title="列表绑定"></a>列表绑定</h2><p>  在此已RecyclerView为例。</p>
<h3 id="单布局"><a href="#单布局" class="headerlink" title="单布局"></a>单布局</h3><p>  <strong>先看item布局：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;layout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:app=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=<span class="string">"item"</span></span><br><span class="line">            type=<span class="string">"lxf.androiddemos.model.MainRecyclerItem"</span>/&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.CardView</span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"60dp"</span></span><br><span class="line">        android:layout_marginLeft=<span class="string">"16dp"</span></span><br><span class="line">        android:layout_marginRight=<span class="string">"16dp"</span></span><br><span class="line">        android:layout_marginTop=<span class="string">"16dp"</span></span><br><span class="line">        app:cardElevation=<span class="string">"5dp"</span></span><br><span class="line">        android:onClick=<span class="string">"@&#123;item.onItemClick&#125;"</span></span><br><span class="line">        &gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_gravity=<span class="string">"center"</span></span><br><span class="line">            android:textSize=<span class="string">"18sp"</span></span><br><span class="line">            android:textColor=<span class="string">"@color/text_green_bg"</span></span><br><span class="line">            android:text=<span class="string">"@&#123;item.content&#125;"</span>/&gt;</span><br><span class="line">    &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure></p>
<p>  这里值得我们关注的有两个地方，一个就是TextView上的数据绑定，一个是父布局上的onClick属性，可以通过这种方式来设置item点击事件，说白了其实就是调用MainRecyclerItem中的一个方法，我们可以通过getter方法很方便的知道当前item的具体数据，具体实现请往下看。<br>　　<strong>model实体类</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainRecyclerItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] items = <span class="keyword">new</span> String[]&#123;<span class="string">"ViewDragHelper"</span>, <span class="string">"自定义Behavior"</span>, <span class="string">"二维码"</span>, <span class="string">"DataBinding"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (getContent()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"ViewDragHelper"</span>:</span><br><span class="line">                intent = <span class="keyword">new</span> Intent(view.getContext(), ViewDragHelperActivity.class);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"自定义Behavior"</span>:</span><br><span class="line">                intent = <span class="keyword">new</span> Intent(view.getContext(), BehaviorActivity.class);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"二维码"</span>:</span><br><span class="line">                intent = <span class="keyword">new</span> Intent(view.getContext(), ZxingActivity.class);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"DataBinding"</span>:</span><br><span class="line">                intent = <span class="keyword">new</span> Intent(view.getContext(), DatabindingActivity.class);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (intent != <span class="keyword">null</span>)</span><br><span class="line">            view.getContext().startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>  <strong>adapter</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RecyclerBindingViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">    ViewDataBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">RecyclerBindingViewHolder</span><span class="params">(ViewDataBinding binding)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(binding.getRoot());</span><br><span class="line">        <span class="keyword">this</span>.binding = binding;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> RecyclerBindingViewHolder <span class="title">createViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> layoutId)</span> </span>&#123;</span><br><span class="line">        ViewDataBinding binding = DataBindingUtil.inflate(LayoutInflater.from(parent.getContext()),layoutId,parent,<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RecyclerBindingViewHolder(binding);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseRecyclerBindingAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">RecyclerBindingViewHolder</span>&gt; <span class="keyword">implements</span> <span class="title">ChangeDataLinstener</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Object&gt; mData;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseRecyclerBindingAdapter</span><span class="params">(List&lt;Object&gt; list)</span> </span>&#123;</span><br><span class="line">        mData = (list != <span class="keyword">null</span>) ? list : <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RecyclerBindingViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> RecyclerBindingViewHolder.createViewHolder(parent,getItemLayoutId(viewType));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(RecyclerBindingViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//绑定数据</span></span><br><span class="line">        holder.binding.setVariable(getItemVariableId(),mData.get(position));</span><br><span class="line">        holder.binding.executePendingBindings();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mData.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setmData</span><span class="params">(List&lt;Object&gt; mData)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mData = mData;</span><br><span class="line">        notifyDataSetChanged();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//item布局id</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getItemLayoutId</span><span class="params">(<span class="keyword">int</span> viewType)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//对应item布局里面data标签中的name，会自动生成一个BR.xxx属性，类似于R文件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getItemVariableId</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　我们这里把adapter写成了一个抽象类，如果没有什么很奇葩的要求，可以算一个通用adapter了，可以看到它没有任何的findviewbyid和set数据，一切都在布局中封装好了，实现非常的简洁。</p>
<h3 id="多布局"><a href="#多布局" class="headerlink" title="多布局"></a>多布局</h3><p>　　如果我们想加一个头部文件，可以这样：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;layout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=<span class="string">"item"</span></span><br><span class="line">            type=<span class="string">"lxf.androiddemos.model.MainRecyclerHeader"</span>/&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"80dp"</span></span><br><span class="line">        android:gravity=<span class="string">"center"</span></span><br><span class="line">        android:text=<span class="string">"@&#123;item.header&#125;"</span></span><br><span class="line">        android:background=<span class="string">"@color/text_orange_bg"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/TextView&gt;</span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure></p>
<p>　　注意和之前的item布局有个相通之处，就是data标签的name属性值是一样的,然后通过getItemViewType实现我们的不同布局即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">datas = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">MainRecyclerHeader header = <span class="keyword">new</span> MainRecyclerHeader();</span><br><span class="line">header.setHeader(<span class="string">"我是头部文件"</span>);</span><br><span class="line">datas.add(header);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MainRecyclerItem.items.length; i++) &#123;</span><br><span class="line">    MainRecyclerItem item = <span class="keyword">new</span> MainRecyclerItem();</span><br><span class="line">    item.setContent(MainRecyclerItem.items[i]);</span><br><span class="line">    datas.add(item);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BaseRecyclerBindingAdapter bindingAdapter = <span class="keyword">new</span> BaseRecyclerBindingAdapter(datas) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemLayoutId</span><span class="params">(<span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> viewType;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemVariableId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> BR.item;<span class="comment">//对应item布局里面data标签中的name</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (position == <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">return</span> R.layout.header_recycler_main;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> R.layout.item_recycler_main;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h2><p>　　事件绑定说白了，其实就是一种特殊的变量绑定，或者说是一个方法的调用。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;layout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--如果本页不需要绑定数据，data标签可以省略--&gt;</span><br><span class="line">    &lt;data <span class="class"><span class="keyword">class</span></span>=<span class="string">"DataBingMain"</span>&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=<span class="string">"user"</span></span><br><span class="line">            type=<span class="string">"lxf.androiddemos.model.UserEntity"</span>/&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=<span class="string">"util"</span></span><br><span class="line">            type=<span class="string">"lxf.androiddemos.test.TestUtil"</span>/&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        ...</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:onClick=<span class="string">"@&#123;util.onBtnClick&#125;"</span></span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;EditText</span><br><span class="line">            android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">			android:onTextChanged=<span class="string">"@&#123;util.onTextChanged&#125;"</span></span><br><span class="line">            /&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">&lt;/layout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBtnClick</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        Toast.makeText(view.getContext(),<span class="string">"onBtnClick"</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span></span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　需要注意的是通过onclick这种方式绑定的事件，实现方法中一定要传入view参数（类似于传统的onClick方法），否则编译会报错。<br>　　同样的官方文档提到，你也可以用这种方式来绑定一些比较偏门的监听，比如上面的onTextChanged，方法参数必须与传统的onTextChanged参数一模一样，否则编译报错，这种方式可以使你只监听onTextChanged一个方法，而非TextWatcher的三个方法，另外EditText本身是没有android:onTextChanged这个属性的，具体实现原理需要先理解一下什么是databinding的自定义属性，会在后文提到。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/Material之CoordinatorLayout-Behavior笔记（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风少侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风少侠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/Material之CoordinatorLayout-Behavior笔记（二）/" itemprop="url">Material之CoordinatorLayout + Behavior笔记（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T11:39:09+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="自定义Behavior"><a href="#自定义Behavior" class="headerlink" title="自定义Behavior"></a>自定义Behavior</h1><p>  自定义Behavior一般有两种情况：</p>
<ul>
<li>某个view监听另一个view的状态变化，例如大小、位置、显示状态等。</li>
<li>某个view监听CoordinatorLayout里的滑动状态。</li>
</ul>
<p>  上面这两句话出自<a href="http://blog.csdn.net/qibin0506/article/details/50290421" target="_blank" rel="noopener">亓斌大神博客</a>，然后我自己在学习过程中做了些实践。</p>
<p>  首先看第一种，其实就是上面那个例子，FloatingActionButton怎么跟随自己的布局上下移动？很明显，这个效果类似于系统提供的FloatingActionButton+Snackbar的效果，看一下FloatingActionButton.Behavior源码（只贴了关键部分）:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Determine whether the supplied child view has another specific sibling view as a</span></span><br><span class="line"><span class="comment">  * layout dependency.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * &lt;p&gt;This method will be called at least once in response to a layout request. If it</span></span><br><span class="line"><span class="comment">  * returns true for a given child and dependency view pair, the parent CoordinatorLayout</span></span><br><span class="line"><span class="comment">  * will:&lt;/p&gt;</span></span><br><span class="line"><span class="comment">  * &lt;ol&gt;</span></span><br><span class="line"><span class="comment">  *     &lt;li&gt;Always lay out this child after the dependent child is laid out, regardless</span></span><br><span class="line"><span class="comment">  *     of child order.&lt;/li&gt;</span></span><br><span class="line"><span class="comment">  *     &lt;li&gt;Call &#123;<span class="doctag">@link</span> #onDependentViewChanged&#125; when the dependency view's layout or</span></span><br><span class="line"><span class="comment">  *     position changes.&lt;/li&gt;</span></span><br><span class="line"><span class="comment">  * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> parent the parent view of the given child</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> child the child view to test</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> dependency the proposed dependency of child</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> true if child's layout depends on the proposed dependency's layout,</span></span><br><span class="line"><span class="comment">  *         false otherwise</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@see</span> #onDependentViewChanged(CoordinatorLayout, android.view.View, android.view.View)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">layoutDependsOn</span><span class="params">(CoordinatorLayout parent,</span></span></span><br><span class="line"><span class="function"><span class="params">         FloatingActionButton child, View dependency)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// We're dependent on all SnackbarLayouts (if enabled)</span></span><br><span class="line">     <span class="keyword">return</span> SNACKBAR_BEHAVIOR_ENABLED &amp;&amp; dependency <span class="keyword">instanceof</span> Snackbar.SnackbarLayout;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDependentViewChanged</span><span class="params">(CoordinatorLayout parent, FloatingActionButton child,</span></span></span><br><span class="line"><span class="function"><span class="params">         View dependency)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (dependency <span class="keyword">instanceof</span> Snackbar.SnackbarLayout) &#123;</span><br><span class="line">         updateFabTranslationForSnackbar(parent, child, dependency);</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dependency <span class="keyword">instanceof</span> AppBarLayout) &#123;</span><br><span class="line">         <span class="comment">// If we're depending on an AppBarLayout we will show/hide it automatically</span></span><br><span class="line">         <span class="comment">// if the FAB is anchored to the AppBarLayout</span></span><br><span class="line">         updateFabVisibility(parent, (AppBarLayout) dependency, child);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>layoutDependsOn(parent,child,dependency)：决定一个child是否有一个其他特殊的兄弟view（dependency）作为布局依赖，听来比较拗口，其实就是指一个child是否会根据另一个view的参数和状态而改变。这个方法在初始化布局时最少会被调用一次，如果返回true，则父布局(CoordinatorLayout)会不断的调用onDependentViewChanged(parent,child, dependency)来改变该child的参数和状态。</li>
<li>然后系统会在onDependentViewChanged中判断dependency的类型，进而改变Fab的参数、状态。<br>下面我们来比葫芦画瓢：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FloatingBehavior</span> <span class="keyword">extends</span> <span class="title">FloatingActionButton</span>.<span class="title">Behavior</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">layoutDependsOn</span><span class="params">(CoordinatorLayout parent, FloatingActionButton child, View dependency)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.layoutDependsOn(parent, child, dependency) || dependency <span class="keyword">instanceof</span> NestedScrollView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDependentViewChanged</span><span class="params">(CoordinatorLayout parent, FloatingActionButton fab, View dependency)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dependency <span class="keyword">instanceof</span> NestedScrollView) &#123;</span><br><span class="line">            CoordinatorLayout.LayoutParams lp = (CoordinatorLayout.LayoutParams) fab.getLayoutParams();</span><br><span class="line">            <span class="keyword">int</span> fab_BM = lp.bottomMargin;</span><br><span class="line">            <span class="keyword">int</span> distance = fab.getHeight() + fab_BM;</span><br><span class="line">            fab.setY(dependency.getY() - distance);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onDependentViewChanged(parent, fab, dependency);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>为Fab设置好改behavior后直接运行，发现报错：Could not inflate Behavior subclass cn.lxf.behaviortext.FloatingBehavior，不能实例化该behavior。一番求证后发现，自定义behavior时<strong>必须重写那个带2个参数的构造方法</strong>，因为在CoordinatorLayout中是通过反射这个构造方法来实例化behavior的，下面贴完整代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FloatingBehavior</span> <span class="keyword">extends</span> <span class="title">FloatingActionButton</span>.<span class="title">Behavior</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FloatingBehavior</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">layoutDependsOn</span><span class="params">(CoordinatorLayout parent, FloatingActionButton child, View dependency)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.layoutDependsOn(parent, child, dependency) || dependency <span class="keyword">instanceof</span> NestedScrollView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDependentViewChanged</span><span class="params">(CoordinatorLayout parent, FloatingActionButton fab, View dependency)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dependency <span class="keyword">instanceof</span> NestedScrollView) &#123;</span><br><span class="line">            CoordinatorLayout.LayoutParams lp = (CoordinatorLayout.LayoutParams) fab.getLayoutParams();</span><br><span class="line">            <span class="keyword">int</span> fab_BM = lp.bottomMargin;</span><br><span class="line">            <span class="keyword">int</span> distance = fab.getHeight() + fab_BM ;</span><br><span class="line">            fab.setY(dependency.getY() - distance);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onDependentViewChanged(parent, fab, dependency);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>  再看第二种情况，某个view监听CoordinateLayout中的滑动状态，这里最好先了解一下android Lollipop版本之后新增的嵌套滑动机制，推荐我学习过的一篇文章<a href="https://segmentfault.com/a/1190000002873657" target="_blank" rel="noopener">https://segmentfault.com/a/1190000002873657</a>。<br>  对于监听滑动状态，我们需要关注的总共有以下几个方法（由于篇幅原因，官方注释被我干掉了，加了简单的注解）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当一个CoordinatorLayout的子view准备去开始一个嵌套滑动时调用</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> coordinatorLayout  根布局coordinatorLayout</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> child 这个behavior所关联的coordinatorLayout的子view</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> directTargetChild 包含target 嵌套滚动操作的coordinatorLayout子view</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> target 开始嵌套滑动的coordinatorLayout子view。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nestedScrollAxes 嵌套滚动的轴线。See</span></span><br><span class="line"><span class="comment"> *                         &#123;<span class="doctag">@link</span> ViewCompat#SCROLL_AXIS_HORIZONTAL&#125;,</span></span><br><span class="line"><span class="comment"> *                         &#123;<span class="doctag">@link</span> ViewCompat#SCROLL_AXIS_VERTICAL&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果behavior希望接受这个嵌套滚动，则返回true。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> NestedScrollingParent#onStartNestedScroll(View, View, int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStartNestedScroll</span><span class="params">(CoordinatorLayout coordinatorLayout,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   V child, View directTargetChild, View target, <span class="keyword">int</span> nestedScrollAxes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当嵌套滑动已经被CoordinatorLayout接受时调用。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 参数同上。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> NestedScrollingParent#onNestedScrollAccepted(View, View, int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScrollAccepted</span><span class="params">(CoordinatorLayout coordinatorLayout, V child,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   View directTargetChild, View target, <span class="keyword">int</span> nestedScrollAxes)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do nothing</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 嵌套滚动结束时调用。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 参数同上。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> NestedScrollingParent#onStopNestedScroll(View)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopNestedScroll</span><span class="params">(CoordinatorLayout coordinatorLayout, V child, View target)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do nothing</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * target滑动之后调用</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> coordinatorLayout 同上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> child 同上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> target 同上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dxConsumed 水平方向target滑动的距离(消耗的距离px)，左滑大于0，右滑小于0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dyConsumed 垂直方向target滑动的距离(消耗的距离px)，上滑大于0，下滑小于0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dxUnconsumed 水平方向target未滑动的距离(但是被用户请求了)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dyUnconsumed 垂直方向target未滑动的距离(但是被用户请求了)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> NestedScrollingParent#onNestedScroll(View, int, int, int, int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScroll</span><span class="params">(CoordinatorLayout coordinatorLayout, V child, View target,</span></span></span><br><span class="line"><span class="function"><span class="params">                           <span class="keyword">int</span> dxConsumed, <span class="keyword">int</span> dyConsumed, <span class="keyword">int</span> dxUnconsumed, <span class="keyword">int</span> dyUnconsumed)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do nothing</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * target准备滑动时（滑动之前）调用</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> coordinatorLayout 同上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> child 同上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> target 同上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dx 水平方向target想要滑动的距离（用户请求的）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dy 垂直方向target想要滑动的距离（用户请求的）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> consumed 需要我们自己传入。 consumed[0] 已经被消费的水平方向滑动的距离, consumed[1] 已经被消费的垂直方向滑动的距离</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> NestedScrollingParent#onNestedPreScroll(View, int, int, int[])</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedPreScroll</span><span class="params">(CoordinatorLayout coordinatorLayout, V child, View target,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> dx, <span class="keyword">int</span> dy, <span class="keyword">int</span>[] consumed)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do nothing</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * target在fling（飞速滚动）之后调用</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> coordinatorLayout 同上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> child 同上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> target 同上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> velocityX 水平方向的速度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> velocityY 垂直方向的速度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> consumed child是否fling了</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> behavior是否消费了这个fling</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> NestedScrollingParent#onNestedFling(View, float, float, boolean)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNestedFling</span><span class="params">(CoordinatorLayout coordinatorLayout, V child, View target,</span></span></span><br><span class="line"><span class="function"><span class="params">                             <span class="keyword">float</span> velocityX, <span class="keyword">float</span> velocityY, <span class="keyword">boolean</span> consumed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * target在fling（飞速滚动）之前调用</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 参数同onNestedFling方法。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> NestedScrollingParent#onNestedPreFling(View, float, float)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNestedPreFling</span><span class="params">(CoordinatorLayout coordinatorLayout, V child, View target,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="keyword">float</span> velocityX, <span class="keyword">float</span> velocityY)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>还是看上面那个FloatingActionButton的例子，改成上滑消失，下滑显示，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FloatingBehavior</span> <span class="keyword">extends</span> <span class="title">FloatingActionButton</span>.<span class="title">Behavior</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isAniming;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FloatingBehavior</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStartNestedScroll</span><span class="params">(CoordinatorLayout coordinatorLayout, FloatingActionButton child, View directTargetChild, View target, <span class="keyword">int</span> nestedScrollAxes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nestedScrollAxes == ViewCompat.SCROLL_AXIS_VERTICAL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScroll</span><span class="params">(CoordinatorLayout coordinatorLayout, FloatingActionButton child, View target, <span class="keyword">int</span> dxConsumed, <span class="keyword">int</span> dyConsumed, <span class="keyword">int</span> dxUnconsumed, <span class="keyword">int</span> dyUnconsumed)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dyConsumed &gt; <span class="number">0</span> &amp;&amp; !isAniming &amp;&amp; child.getVisibility() == View.VISIBLE) &#123;</span><br><span class="line">            hide(child);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dyConsumed &lt; <span class="number">0</span> &amp;&amp; !isAniming &amp;&amp; child.getVisibility() == View.INVISIBLE) &#123;</span><br><span class="line">            show(child);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">final</span> View view)</span></span>&#123;</span><br><span class="line">        ValueAnimator animator = ValueAnimator.ofFloat(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">        animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">float</span> f = (<span class="keyword">float</span>) animation.getAnimatedValue();</span><br><span class="line">                view.setScaleX(f);</span><br><span class="line">                view.setScaleY(f);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        animator.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                view.setVisibility(View.VISIBLE);</span><br><span class="line">                isAniming = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                isAniming = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                isAniming = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        animator.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hide</span><span class="params">(<span class="keyword">final</span> View view)</span></span>&#123;</span><br><span class="line">        ValueAnimator animator = ValueAnimator.ofFloat(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">float</span> f = (<span class="keyword">float</span>) animation.getAnimatedValue();</span><br><span class="line">                view.setScaleX(f);</span><br><span class="line">                view.setScaleY(f);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        animator.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                isAniming = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                view.setVisibility(View.INVISIBLE);</span><br><span class="line">                isAniming = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                isAniming = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        animator.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>效果图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-bbf0d9249a01b382.gif?imageMogr2/auto-orient/strip" alt="监听CoordinatorLayout中的滑动状态"></p>
<p><a href="https://github.com/lunxinfeng/AndroidDemos" target="_blank" rel="noopener">Demo地址</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/Material之CoordinatorLayout-Behavior笔记（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风少侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风少侠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/Material之CoordinatorLayout-Behavior笔记（一）/" itemprop="url">Material之CoordinatorLayout + Behavior笔记（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-27T11:25:04+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最新项目中用到了些Material效果，在此对自己的学习做个小结。</p>
<p>  首先养成良好的学习习惯—–看源码：</p>
<h3 id="CoordinatorLayout"><a href="#CoordinatorLayout" class="headerlink" title="CoordinatorLayout"></a>CoordinatorLayout</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CoordinatorLayout is a super-powered &#123;<span class="doctag">@link</span> android.widget.FrameLayout FrameLayout&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;CoordinatorLayout is intended for two primary use cases:&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;ol&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;As a top-level application decor or chrome layout&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;As a container for a specific interaction with one or more child views&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;By specifying &#123;<span class="doctag">@link</span> CoordinatorLayout.Behavior Behaviors&#125; for child views of a</span></span><br><span class="line"><span class="comment"> * CoordinatorLayout you can provide many different interactions within a single parent and those</span></span><br><span class="line"><span class="comment"> * views can also interact with one another. View classes can specify a default behavior when</span></span><br><span class="line"><span class="comment"> * used as a child of a CoordinatorLayout using the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> CoordinatorLayout.DefaultBehavior DefaultBehavior&#125; annotation.&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Behaviors may be used to implement a variety of interactions and additional layout</span></span><br><span class="line"><span class="comment"> * modifications ranging from sliding drawers and panels to swipe-dismissable elements and buttons</span></span><br><span class="line"><span class="comment"> * that stick to other elements as they move and animate.&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Children of a CoordinatorLayout may have an</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> CoordinatorLayout.LayoutParams#setAnchorId(int) anchor&#125;. This view id must correspond</span></span><br><span class="line"><span class="comment"> * to an arbitrary descendant of the CoordinatorLayout, but it may not be the anchored child itself</span></span><br><span class="line"><span class="comment"> * or a descendant of the anchored child. This can be used to place floating views relative to</span></span><br><span class="line"><span class="comment"> * other arbitrary content panes.&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CoordinatorLayout</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> <span class="keyword">implements</span> <span class="title">NestedScrollingParent</span> </span>&#123;</span><br></pre></td></tr></table></figure>
<p>  大概的翻译如下：</p>
<ul>
<li>CoordinateLayout是一个超级FrameLayout。</li>
<li>CoordinateLayout原意是用于以下情况：<ol>
<li>作为<strong>顶层布局</strong>。</li>
<li>作为一个容器，它的<strong>子View</strong>之间有特殊的<strong>相互作用（交互）</strong>。</li>
</ol>
</li>
<li>通过为CoordinatorLayout的子views指定<strong>Behavior</strong>，在同一个父容器下可以提供不同的交互，并且那些子view可以和另一个子view相互作用，相互影响。通过<strong>@DefaultBehavior</strong>注释，CoordinatorLayout的子view可以使用一个默认的behavior。</li>
<li>Behavior可以用来实现各种交互和 来自滑动抽屉、滑动删除元素和按钮关联其他元素产生的额外的布局修改。</li>
<li>CoordinatorLayout的子view也许会有个anchor（锚点，即view显示在哪块区域），这个子view必须是CoordinatorLayout的<strong>直接子view</strong>，不能是孙子辈儿的view - -！<br>通过看CoordinatorLayout官方注释文档，了解到一个重要信息—Behavior，可以说CoordinatorLayout各种炫酷的交互效果，都是通过Behavior来控制的，除此之外，CoordinatorLayout类似于FrameLayout，那么接下来看重点：<h3 id="Behavior："><a href="#Behavior：" class="headerlink" title="Behavior："></a>Behavior：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Interaction behavior plugin for child views of &#123;<span class="doctag">@link</span> CoordinatorLayout&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;A Behavior implements one or more interactions that a user can take on a child view.</span></span><br><span class="line"><span class="comment"> * These interactions may include drags, swipes, flings, or any other gestures.&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;V&gt; The View type that this Behavior operates on</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Behavior</span>&lt;<span class="title">V</span> <span class="keyword">extends</span> <span class="title">View</span>&gt; </span>&#123;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>老规矩：</p>
<ul>
<li>CoordinatorLayout的子view的交互行为插件。</li>
<li>一个Behavior可以实现一个或更多的交互，用户可以将这些交互用在CoordinatorLayout的子view上，这些交互包括：<strong>拖拽、滑动、飞速滑动、或者其他任何手势</strong>。</li>
</ul>
<h3 id="基本使用："><a href="#基本使用：" class="headerlink" title="基本使用："></a>基本使用：</h3><p>  新建一个HelloWorld，选择BasicActivity，可以看到默认生成的布局中已经包含了CoordinatorLayout，说明Goolge官方非常推荐使用这种布局。<br>官方给出的Behavior实现类有4个：</p>
<ul>
<li>BottomSheetBehavior</li>
<li>SwipeDismissBehavior</li>
<li>FloatingActionButton中实现的Behavior</li>
<li>ViewOffsetBehavior</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-82c345e3e94dec19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Behavior实现类"></p>
<h4 id="BottomSheetBehavior"><a href="#BottomSheetBehavior" class="headerlink" title="BottomSheetBehavior"></a>BottomSheetBehavior</h4><p>一般用于底部弹出框，类似于微信支付的效果，使用方法如下：</p>
<p>xml布局<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span></span></span><br><span class="line"><span class="tag">  <span class="attr">......</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/nestedScrollView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"350dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@drawable/mv"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">"@string/bottom_sheet_behavior"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:behavior_peekHeight</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:behavior_hideable</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--中间可以随意写自己的布局--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/fab"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"bottom|end"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">"@dimen/fab_margin"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">"cn.lxf.behaviortext.FloatingBehavior"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:srcCompat</span>=<span class="string">"@android:drawable/ic_dialog_email"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Activity代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scrollView = (NestedScrollView) findViewById(R.id.nestedScrollView);</span><br><span class="line">FloatingActionButton fab = (FloatingActionButton) findViewById(R.id.fab);</span><br><span class="line">fab.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">          BottomSheetBehavior bottomSheetBehavior = BottomSheetBehavior.from(scrollView);</span><br><span class="line">          bottomSheetBehavior.setState(bottomSheetBehavior.getState() == BottomSheetBehavior.STATE_COLLAPSED?BottomSheetBehavior.STATE_EXPANDED:BottomSheetBehavior.STATE_COLLAPSED);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>bottomSheetBehavior效果图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-be6809dac7a5b3e0.gif?imageMogr2/auto-orient/strip" alt="bottomSheetBehavior"></p>
<p>实现的关键点：</p>
<ul>
<li>根布局为 CoordinatorLayout；</li>
<li>为底部弹出框设置app:layout_behavior=”@string/bottom_sheet_behavior”；</li>
<li>在代码中得到BottomSheetBehavior，并动态改变它的状态；</li>
<li>至于FloatingActionButton跟随弹出框移动，关键点在于为FloatingActionButton设置app:layout_behavior=”cn.lxf.behaviortext.FloatingBehavior”；这是一个自定义的Behavior，文章后面会有讲解。</li>
</ul>
<h4 id="SwipeDismissBehavior"><a href="#SwipeDismissBehavior" class="headerlink" title="SwipeDismissBehavior"></a>SwipeDismissBehavior</h4><p>  官方实现为Snackbar，已经封装好，唯一的条件是<strong>根布局必须为CoordinatorLayout</strong>，否则没有效果。<br>  使用方式很简单：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Snackbar.make(view, <span class="string">"Replace with your own action"</span>, Snackbar.LENGTH_LONG).setAction(<span class="string">"Action"</span>, <span class="keyword">null</span>).show();</span><br></pre></td></tr></table></figure></p>
<h4 id="FloatingActionButton-Behavior"><a href="#FloatingActionButton-Behavior" class="headerlink" title="FloatingActionButton.Behavior"></a>FloatingActionButton.Behavior</h4><p>FloatingActionButton默认使用FloatingActionButton.Behavior，同Snackbar一样，唯一需要注意的是根布局必须为CoordinatorLayout。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CoordinatorLayout</span>.DefaultBehavior(FloatingActionButton.Behavior.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FloatingActionButton</span> <span class="keyword">extends</span> <span class="title">VisibilityAwareImageButton</span> </span>&#123;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/fab"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"bottom|end"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">"@dimen/fab_margin"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:srcCompat</span>=<span class="string">"@android:drawable/ic_dialog_email"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>Snackbar + FloatingActionButton效果图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-ffebe2efe40de972.gif?imageMogr2/auto-orient/strip" alt="Snackbar + FloatingActionButton效果图"></p>
<h4 id="ViewOffsetBehavior"><a href="#ViewOffsetBehavior" class="headerlink" title="ViewOffsetBehavior"></a>ViewOffsetBehavior</h4><p>  官方实现为AppBarLayout中的Beihavior。<br><img src="http://upload-images.jianshu.io/upload_images/1215918-23de41d0e43c72b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AppBarLayout官方文档"><br>挑重点：</p>
<ul>
<li>AppBarLayout是一个实现了很多Material设计风格的<strong>垂直的LinearLayout</strong>。</li>
<li>子view可以通过设置<strong>layout_scrollFlags</strong>来提供他们所需要的滚动方式。</li>
<li>你需要设置你的<strong>Scrolling view的behavior</strong>（app:layout_behavior）为<strong>AppBarLayout.ScrollingViewBehavior</strong>来提醒AppBarLayout什么时候滚动。</li>
<li><p>最下面为goolgle官方提供的一个例子。<br>话说第一次看到layout_scrollFlags属性的萌新必然会一脸懵逼，到底应该填什么呢（因为我当初就是这样…( ╯□╰ )），这里顺便介绍ScrollFlags的几个常量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The view will be scroll in direct relation to scroll events. This flag needs to be</span></span><br><span class="line"><span class="comment"> * set for any of the other flags to take effect. If any sibling views</span></span><br><span class="line"><span class="comment"> * before this one do not have this flag, then this value has no effect.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCROLL_FLAG_SCROLL = <span class="number">0x1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * When exiting (scrolling off screen) the view will be scrolled until it is</span></span><br><span class="line"><span class="comment"> * 'collapsed'. The collapsed height is defined by the view's minimum height.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ViewCompat#getMinimumHeight(View)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> View#setMinimumHeight(int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCROLL_FLAG_EXIT_UNTIL_COLLAPSED = <span class="number">0x2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * When entering (scrolling on screen) the view will scroll on any downwards</span></span><br><span class="line"><span class="comment"> * scroll event, regardless of whether the scrolling view is also scrolling. This</span></span><br><span class="line"><span class="comment"> * is commonly referred to as the 'quick return' pattern.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCROLL_FLAG_ENTER_ALWAYS = <span class="number">0x4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An additional flag for 'enterAlways' which modifies the returning view to</span></span><br><span class="line"><span class="comment"> * only initially scroll back to it's collapsed height. Once the scrolling view has</span></span><br><span class="line"><span class="comment"> * reached the end of it's scroll range, the remainder of this view will be scrolled</span></span><br><span class="line"><span class="comment"> * into view. The collapsed height is defined by the view's minimum height.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ViewCompat#getMinimumHeight(View)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> View#setMinimumHeight(int)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCROLL_FLAG_ENTER_ALWAYS_COLLAPSED = <span class="number">0x8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Upon a scroll ending, if the view is only partially visible then it will be snapped</span></span><br><span class="line"><span class="comment"> * and scrolled to it's closest edge. For example, if the view only has it's bottom 25%</span></span><br><span class="line"><span class="comment"> * displayed, it will be scrolled off screen completely. Conversely, if it's bottom 75%</span></span><br><span class="line"><span class="comment"> * is visible then it will be scrolled fully into view.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCROLL_FLAG_SNAP = <span class="number">0x10</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>SCROLL_FLAG_SCROLL</strong>：对应xml布局中的scroll，如果要设置其他的滚动flag，这个flag<strong>必须要设置</strong>，否则无效。</p>
</li>
<li><strong>SCROLL_FLAG_EXIT_UNTIL_COLLAPSED</strong>：对应xml布局中的exitUntilCollapsed，设置该flag的view在向上滑动退出屏幕时，不会完全退出，会保留collapsed height（minHeight）高度。</li>
<li><strong>SCROLL_FLAG_ENTER_ALWAYS</strong>：对应xml布局中的enterAlways，只要手指向下滑，设置该flag的view就会直接进入屏幕，不管NestedScrollView是否在滚动。</li>
<li><strong>SCROLL_FLAG_ENTER_ALWAYS_COLLAPSED</strong> ：对应xml布局中的enterAlwaysCollapsed，是enterAlways的附加flag，使设置该flag的view在进入屏幕时最初只滑动显示到它的collapsed height（minHeight），一旦NestedScrollView滑到顶部，该view再滑动显示剩余的部分。</li>
<li><strong>SCROLL_FLAG_SNAP</strong>：对应xml布局中的snap，设置该flag的view在滚动停止时，如果没有完全显示，会自动滚到到最近的一个边界（顶端、中线和下线）。</li>
</ul>
<p>scroll：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-4bb1c9b9ef5e0bdb.gif?imageMogr2/auto-orient/strip" alt="scroll"></p>
<p>scroll+exitUntilCollapsed：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-8df8e86ff727877c.gif?imageMogr2/auto-orient/strip" alt="scroll+exitUntilCollapsed"></p>
<p>scroll+enterAlways：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-e79423f6f7d93de5.gif?imageMogr2/auto-orient/strip" alt="scroll+enterAlways"></p>
<p>scroll+enterAlways+enterAlwaysCollapsed：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-946022ce80784e08.gif?imageMogr2/auto-orient/strip" alt="scroll+enterAlways+enterAlwaysCollapsed"></p>
<p>scroll+enterAlways+snap：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1215918-22c675c74d224a67.gif?imageMogr2/auto-orient/strip" alt="scroll+enterAlways+snap"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/26/新的开始/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风少侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风少侠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/26/新的开始/" itemprop="url">新的开始</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-26T16:00:09+08:00">
                2018-01-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<p>  最近准备整理一下自己之前写过的博客，将一些有意义的文章迁移到这个个人博客，努力经营自己的小窝~~</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/26/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="风少侠">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="风少侠的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/26/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-26T14:01:15+08:00">
                2018-01-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">风少侠</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">风少侠</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
